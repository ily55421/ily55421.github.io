<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10 Java Agentä¸å­—èŠ‚ç æ³¨å…¥ | ily55421</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132133.ico">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="ğŸ’»å­¦ä¹ ğŸ“è®°å½•ğŸ”—åˆ†äº«
å­¦æ— æ­¢å¢ƒæ˜¯æ°¸è¿œå‰è¿›çš„åŸºç¡€ï¼Œè·ƒç„¶çº¸ä¸Šæ˜¯å¯¹çŸ¥è¯†çš„æ€»ç»“äº¤ä»£ï¼Œä¸ä¼—åˆ†äº«åˆ™æ˜¯å®ç°ä»·å€¼çš„æœ€å¥½æ–¹å¼ã€‚">
    <meta name="keywords" content="ily55421,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.5cf13956.css" as="style"><link rel="preload" href="/assets/js/app.e5f1d04a.js" as="script"><link rel="preload" href="/assets/js/5.5ca26c73.js" as="script"><link rel="preload" href="/assets/js/59.e57a2ed8.js" as="script"><link rel="prefetch" href="/assets/js/10.32a16328.js"><link rel="prefetch" href="/assets/js/11.51f4dee0.js"><link rel="prefetch" href="/assets/js/12.47439b7b.js"><link rel="prefetch" href="/assets/js/13.fa6da581.js"><link rel="prefetch" href="/assets/js/14.a4af8b3e.js"><link rel="prefetch" href="/assets/js/15.1bac7980.js"><link rel="prefetch" href="/assets/js/16.c546c54e.js"><link rel="prefetch" href="/assets/js/17.efb08615.js"><link rel="prefetch" href="/assets/js/18.9b2c4127.js"><link rel="prefetch" href="/assets/js/19.638baf15.js"><link rel="prefetch" href="/assets/js/20.eae2ec52.js"><link rel="prefetch" href="/assets/js/21.6028e4c6.js"><link rel="prefetch" href="/assets/js/22.65b9e8bc.js"><link rel="prefetch" href="/assets/js/23.d38fc218.js"><link rel="prefetch" href="/assets/js/24.c702b259.js"><link rel="prefetch" href="/assets/js/25.6037b17d.js"><link rel="prefetch" href="/assets/js/26.8d2093a1.js"><link rel="prefetch" href="/assets/js/27.f00503b6.js"><link rel="prefetch" href="/assets/js/28.ae218bba.js"><link rel="prefetch" href="/assets/js/29.53603481.js"><link rel="prefetch" href="/assets/js/30.f6209a54.js"><link rel="prefetch" href="/assets/js/31.2a3dd39a.js"><link rel="prefetch" href="/assets/js/32.c76da96e.js"><link rel="prefetch" href="/assets/js/33.55338ecc.js"><link rel="prefetch" href="/assets/js/34.e4a4c9b4.js"><link rel="prefetch" href="/assets/js/35.c92aeb3b.js"><link rel="prefetch" href="/assets/js/36.8f6939f8.js"><link rel="prefetch" href="/assets/js/37.5f1cbc25.js"><link rel="prefetch" href="/assets/js/38.29a7134b.js"><link rel="prefetch" href="/assets/js/39.e9182250.js"><link rel="prefetch" href="/assets/js/40.9a91f960.js"><link rel="prefetch" href="/assets/js/41.10c04e65.js"><link rel="prefetch" href="/assets/js/42.eaf840e9.js"><link rel="prefetch" href="/assets/js/43.ec28b695.js"><link rel="prefetch" href="/assets/js/44.e3c0a33f.js"><link rel="prefetch" href="/assets/js/45.217b1ef2.js"><link rel="prefetch" href="/assets/js/46.9a3a1678.js"><link rel="prefetch" href="/assets/js/47.cfde839a.js"><link rel="prefetch" href="/assets/js/48.a1b46b15.js"><link rel="prefetch" href="/assets/js/49.958486e7.js"><link rel="prefetch" href="/assets/js/50.7f71ef15.js"><link rel="prefetch" href="/assets/js/51.379bc3d5.js"><link rel="prefetch" href="/assets/js/52.915db24c.js"><link rel="prefetch" href="/assets/js/53.2b8a25d1.js"><link rel="prefetch" href="/assets/js/54.2fb45c99.js"><link rel="prefetch" href="/assets/js/55.b580bc6b.js"><link rel="prefetch" href="/assets/js/56.f2a876b1.js"><link rel="prefetch" href="/assets/js/57.0b337b28.js"><link rel="prefetch" href="/assets/js/58.c51f72c4.js"><link rel="prefetch" href="/assets/js/6.3396a9ee.js"><link rel="prefetch" href="/assets/js/60.cc5d9d89.js"><link rel="prefetch" href="/assets/js/61.5f762f80.js"><link rel="prefetch" href="/assets/js/62.04285b34.js"><link rel="prefetch" href="/assets/js/63.97495516.js"><link rel="prefetch" href="/assets/js/64.d02e2c76.js"><link rel="prefetch" href="/assets/js/65.5e7d91f2.js"><link rel="prefetch" href="/assets/js/66.b6b38a09.js"><link rel="prefetch" href="/assets/js/67.0e8ef811.js"><link rel="prefetch" href="/assets/js/68.ec22ebe4.js"><link rel="prefetch" href="/assets/js/69.6fc63975.js"><link rel="prefetch" href="/assets/js/7.0d4d4fc2.js"><link rel="prefetch" href="/assets/js/70.b95de4a1.js"><link rel="prefetch" href="/assets/js/71.6cd4b167.js"><link rel="prefetch" href="/assets/js/72.5edf7f96.js"><link rel="prefetch" href="/assets/js/73.5a1caaac.js"><link rel="prefetch" href="/assets/js/74.53473d38.js"><link rel="prefetch" href="/assets/js/8.45b70426.js"><link rel="prefetch" href="/assets/js/9.6c002df9.js"><link rel="prefetch" href="/assets/js/mermaid.f2857331.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.c013cef0.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.23884ed8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5cf13956.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132208.png" alt="ily55421" class="logo"> <span class="site-name can-hide">ily55421</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•ä¸æ•°æ®ç»“æ„" class="dropdown-title"><a href="/algorithm/" class="link-title">ç®—æ³•ä¸æ•°æ®ç»“æ„</a> <span class="title" style="display:none;">ç®—æ³•ä¸æ•°æ®ç»“æ„</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24768e/" class="nav-link">ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/pages/24770e/" class="nav-link">æ•°æ®ç»“æ„</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a4770e/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bc7034/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ace3fe/" class="nav-link">JAVA</a></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f2e80b/" class="nav-link">Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</a></li><li class="dropdown-subitem"><a href="/pages/bf46c5/" class="nav-link">é«˜æ•ˆç¼–è¯‘</a></li><li class="dropdown-subitem"><a href="/pages/1261df/" class="nav-link">ä»£ç ä¼˜åŒ–</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">ç•™è¨€æ¿</a></div><div class="nav-item"><a href="https://ily55421.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æˆ‘çš„åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•ä¸æ•°æ®ç»“æ„" class="dropdown-title"><a href="/algorithm/" class="link-title">ç®—æ³•ä¸æ•°æ®ç»“æ„</a> <span class="title" style="display:none;">ç®—æ³•ä¸æ•°æ®ç»“æ„</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24768e/" class="nav-link">ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/pages/24770e/" class="nav-link">æ•°æ®ç»“æ„</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a4770e/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bc7034/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ace3fe/" class="nav-link">JAVA</a></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f2e80b/" class="nav-link">Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</a></li><li class="dropdown-subitem"><a href="/pages/bf46c5/" class="nav-link">é«˜æ•ˆç¼–è¯‘</a></li><li class="dropdown-subitem"><a href="/pages/1261df/" class="nav-link">ä»£ç ä¼˜åŒ–</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">ç•™è¨€æ¿</a></div><div class="nav-item"><a href="https://ily55421.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æˆ‘çš„åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JAVA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ace3fe/" class="sidebar-link">ä¼˜é›…æ•´æ´çš„ Java ä»£ç å‘½åæŠ€å·§</a></li><li><a href="/pages/24768e1/" class="sidebar-link">Java å‡½æ•°å¼ç¼–ç¨‹</a></li><li><a href="/pages/68a0f3/" class="sidebar-link">è®¡ç®—æœºç½‘ç»œ</a></li><li><a href="/pages/8339ba/" class="sidebar-link">å‡½æ•°å¼ç¼–ç¨‹æœ¯è¯­</a></li><li><a href="/pages/738bf8/" class="sidebar-link">JAVAä¸­çš„Stream</a></li><li><a href="/pages/df0b43/" class="sidebar-link">javaç¨‹åºå‘˜æˆé•¿</a></li><li><a href="/pages/c66ef2/" class="sidebar-link">Lambdas ä½¿ç”¨</a></li><li><a href="/pages/028f22/" class="sidebar-link">æ·±æŒ– Redis 6.0 æºç â€”â€”SDS</a></li><li><a href="/pages/604ba8/" class="sidebar-link">Sentinel æºç è§£æ</a></li><li><a href="/pages/f3827f/" class="sidebar-link">Spring Security è¯·æ±‚å…¨è¿‡ç¨‹è§£æ</a></li><li><a href="/pages/09a46a/" class="sidebar-link">Servlet</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JVM</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E7%BC%96%E7%A8%8B%E4%B8%96%E7%95%8C" title="åˆ†ç±»" data-v-06225672>ç¼–ç¨‹ä¸–ç•Œ</a></li><li data-v-06225672><a href="/categories/?category=JVM" title="åˆ†ç±»" data-v-06225672>JVM</a></li><li data-v-06225672><a href="/categories/?category=%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96" title="åˆ†ç±»" data-v-06225672>ä»£ç ä¼˜åŒ–</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/ily55421" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>ily55421</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">10 Java Agentä¸å­—èŠ‚ç æ³¨å…¥<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_33-java-agentä¸å­—èŠ‚ç æ³¨å…¥"><a href="#_33-java-agentä¸å­—èŠ‚ç æ³¨å…¥" class="header-anchor">#</a> 33 | Java Agentä¸å­—èŠ‚ç æ³¨å…¥</h1> <p>å…³äº Java agentï¼Œå¤§å®¶å¯èƒ½éƒ½å¬è¿‡å¤§åé¼é¼çš„<code>premain</code>æ–¹æ³•ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹æ³•æŒ‡çš„å°±æ˜¯åœ¨<code>main</code>æ–¹æ³•ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
package org.example;

 

public class MyAgent {

  public static void premain(String args) {

    System.out.println(&quot;premain&quot;);

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æˆ‘åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ª<code>premain</code>æ–¹æ³•ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJava è™šæ‹Ÿæœºæ‰€èƒ½è¯†åˆ«çš„<code>premain</code>æ–¹æ³•æ¥æ”¶çš„æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ï¼Œè€Œå¹¶éç±»ä¼¼äº<code>main</code>æ–¹æ³•çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚</p> <p>ä¸ºäº†èƒ½å¤Ÿä»¥ Java agent çš„æ–¹å¼è¿è¡Œè¯¥<code>premain</code>æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ‰“åŒ…æˆ jar åŒ…ï¼Œå¹¶åœ¨å…¶ä¸­çš„ MANIFEST.MF é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šæ‰€è°“çš„<code>Premain-class</code>ã€‚å…·ä½“çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
# æ³¨æ„ç¬¬ä¸€æ¡å‘½ä»¤ä¼šå‘ manifest.txt æ–‡ä»¶å†™å…¥ä¸¤è¡Œæ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€è¡Œç©ºè¡Œ

$ echo 'Premain-Class: org.example.MyAgent

' &gt; manifest.txt

$ jar cvmf manifest.txt myagent.jar org/

$ java -javaagent:myagent.jar HelloWorld

premain

Hello, World
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>é™¤äº†åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®š Java agent ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Attach API è¿œç¨‹åŠ è½½ã€‚å…·ä½“ç”¨æ³•å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
import java.io.IOException;

 

import com.sun.tools.attach.*;

 

public class AttachTest {

  public static void main(String[] args)

      throws AttachNotSupportedException, IOException, AgentLoadException, AgentInitializationException {

    if (args.length &lt;= 1) {

      System.out.println(&quot;Usage: java AttachTest &lt;PID&gt; /PATH/TO/AGENT.jar&quot;);

      return;

    }

    VirtualMachine vm = VirtualMachine.attach(args[0]);

    vm.loadAgent(args[1]);

  }

}

 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>ä½¿ç”¨ Attach API è¿œç¨‹åŠ è½½çš„ Java agent ä¸ä¼šå†å…ˆäº<code>main</code>æ–¹æ³•æ‰§è¡Œï¼Œè¿™å–å†³äºå¦ä¸€è™šæ‹Ÿæœºè°ƒç”¨ Attach API çš„æ—¶æœºã€‚å¹¶ä¸”ï¼Œå®ƒè¿è¡Œçš„ä¹Ÿä¸å†æ˜¯<code>premain</code>æ–¹æ³•ï¼Œè€Œæ˜¯åä¸º<code>agentmain</code>çš„æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
public class MyAgent { 

  public static void agentmain(String args) {

    System.out.println(&quot;agentmain&quot;);

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç›¸åº”çš„ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° jar åŒ…ä¸­çš„ manifest æ–‡ä»¶ï¼Œä½¿å…¶åŒ…å«<code>Agent-Class</code>çš„é…ç½®ï¼Œä¾‹å¦‚<code>Agent-Class: org.example.MyAgent</code>ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
$ echo 'Agent-Class: org.example.MyAgent

' &gt; manifest.txt

$ jar cvmf manifest.txt myagent.jar org/

$ java HelloWorld

Hello, World

$ jps

$ java AttachTest &lt;pid&gt; myagent.jar

agentmain

// æœ€åä¸€å¥è¾“å‡ºæ¥è‡ªäºè¿è¡Œ HelloWorld çš„ Java è¿›ç¨‹
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Java è™šæ‹Ÿæœºå¹¶ä¸é™åˆ¶ Java agent çš„æ•°é‡ã€‚ä½ å¯ä»¥åœ¨ java å‘½ä»¤åé™„ä¸Šå¤šä¸ª<code>-javaagent</code>å‚æ•°ï¼Œæˆ–è€…è¿œç¨‹ attach å¤šä¸ª Java agentï¼ŒJava è™šæ‹Ÿæœºä¼šæŒ‰ç…§å®šä¹‰é¡ºåºï¼Œæˆ–è€… attach çš„é¡ºåºé€ä¸ªæ‰§è¡Œè¿™äº› Java agentã€‚</p> <p>åœ¨<code>premain</code>æ–¹æ³•æˆ–è€…<code>agentmain</code>æ–¹æ³•ä¸­æ‰“å°ä¸€äº›å­—ç¬¦ä¸²å¹¶ä¸å‡ºå¥‡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†å…¶ä¸­çš„é€»è¾‘å¹¶å…¥<code>main</code>æ–¹æ³•ï¼Œæˆ–è€…å…¶ä»–ç›‘å¬ç«¯å£çš„çº¿ç¨‹ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJava agent è¿˜æä¾›äº†ä¸€å¥— instrumentation æœºåˆ¶ï¼Œå…è®¸åº”ç”¨ç¨‹åºæ‹¦æˆªç±»åŠ è½½äº‹ä»¶ï¼Œå¹¶ä¸”æ›´æ”¹è¯¥ç±»çš„å­—èŠ‚ç ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹åŸºäºè¿™ä¸€æœºåˆ¶çš„å­—èŠ‚ç æ³¨å…¥ã€‚</p> <h2 id="å­—èŠ‚ç æ³¨å…¥"><a href="#å­—èŠ‚ç æ³¨å…¥" class="header-anchor">#</a> å­—èŠ‚ç æ³¨å…¥</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>
package org.example;

 

import java.lang.instrument.*;

import java.security.ProtectionDomain;

 

public class MyAgent {

  public static void premain(String args, Instrumentation instrumentation) {

    instrumentation.addTransformer(new MyTransformer());

  }

 

  static class MyTransformer implements ClassFileTransformer {

    public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,

        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {

      System.out.printf(&quot;Loaded %s: 0x%X%X%X%X\n&quot;, className, classfileBuffer[0], classfileBuffer[1],

          classfileBuffer[2], classfileBuffer[3]);

      return null;

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œ<code>premain</code>æ–¹æ³•å¤šå‡ºäº†ä¸€ä¸ª<code>Instrumentation</code>ç±»å‹çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥æ³¨å†Œç±»åŠ è½½äº‹ä»¶çš„æ‹¦æˆªå™¨ã€‚è¯¥æ‹¦æˆªå™¨éœ€è¦å®ç°<code>ClassFileTransformer</code>æ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­çš„<code>transform</code>æ–¹æ³•ã€‚</p> <p><code>transform</code>æ–¹æ³•å°†æ¥æ”¶ä¸€ä¸ª byte æ•°ç»„ç±»å‹çš„å‚æ•°ï¼Œå®ƒä»£è¡¨çš„æ˜¯æ­£åœ¨è¢«åŠ è½½çš„ç±»çš„å­—èŠ‚ç ã€‚åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘å°†æ‰“å°è¯¥æ•°ç»„çš„å‰å››ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ Java class æ–‡ä»¶çš„é­”æ•°ï¼ˆmagic numberï¼‰0xCAFEBABEã€‚</p> <p><code>transform</code>æ–¹æ³•å°†è¿”å›ä¸€ä¸ª byte æ•°ç»„ï¼Œä»£è¡¨æ›´æ–°è¿‡åçš„ç±»çš„å­—èŠ‚ç ã€‚å½“æ–¹æ³•è¿”å›ä¹‹åï¼ŒJava è™šæ‹Ÿæœºä¼šä½¿ç”¨æ‰€è¿”å›çš„ byte æ•°ç»„ï¼Œæ¥å®Œæˆæ¥ä¸‹æ¥çš„ç±»åŠ è½½å·¥ä½œã€‚ä¸è¿‡ï¼Œå¦‚æœ<code>transform</code>æ–¹æ³•è¿”å› null æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºå°†ä½¿ç”¨åŸæ¥çš„ byte æ•°ç»„å®Œæˆç±»åŠ è½½å·¥ä½œã€‚</p> <p>åŸºäºè¿™ä¸€ç±»åŠ è½½äº‹ä»¶çš„æ‹¦æˆªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å­—èŠ‚ç æ³¨å…¥ï¼ˆbytecode instrumentationï¼‰ï¼Œå¾€æ­£åœ¨è¢«åŠ è½½çš„ç±»ä¸­æ’å…¥é¢å¤–çš„å­—èŠ‚ç ã€‚</p> <p>åœ¨å·¥å…·ç¯‡ä¸­æˆ‘æ›¾ç»ä»‹ç»è¿‡å­—èŠ‚ç å·¥ç¨‹æ¡†æ¶ ASM çš„ç”¨æ³•ã€‚ä¸‹é¢æˆ‘å°†æ¼”ç¤ºå®ƒçš„<a href="https://search.maven.org/artifact/org.ow2.asm/asm-tree/7.0-beta/jar" target="_blank" rel="noopener noreferrer">tree åŒ…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼ˆä¾èµ–äº<a href="https://search.maven.org/artifact/org.ow2.asm/asm/7.0-beta/jar" target="_blank" rel="noopener noreferrer">åŸºç¡€åŒ…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰ï¼Œç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ³¨å…¥å­—èŠ‚ç ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
package org.example;

 

import java.lang.instrument.*;

import java.security.ProtectionDomain;

import org.objectweb.asm.*;

import org.objectweb.asm.tree.*;

 

public class MyAgent {

  public static void premain(String args, Instrumentation instrumentation) {

    instrumentation.addTransformer(new MyTransformer());

  }

 

  static class MyTransformer implements ClassFileTransformer, Opcodes {

    public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,

        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {

      ClassReader cr = new ClassReader(classfileBuffer);

      ClassNode classNode = new ClassNode(ASM7);

      cr.accept(classNode, ClassReader.SKIP_FRAMES);

 

      for (MethodNode methodNode : classNode.methods) {

        if (&quot;main&quot;.equals(methodNode.name)) {

          InsnList instrumentation = new InsnList();

          instrumentation.add(new FieldInsnNode(GETSTATIC, &quot;java/lang/System&quot;, &quot;out&quot;, &quot;Ljava/io/PrintStream;&quot;));

          instrumentation.add(new LdcInsnNode(&quot;Hello, Instrumentation!&quot;));

          instrumentation

              .add(new MethodInsnNode(INVOKEVIRTUAL, &quot;java/io/PrintStream&quot;, &quot;println&quot;, &quot;(Ljava/lang/String;)V&quot;, false));

 

          methodNode.instructions.insert(instrumentation);

        }

      }

 

      ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);

      classNode.accept(cw);

      return cw.toByteArray();

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>ä¸Šé¢è¿™æ®µä»£ç ä¸éš¾ç†è§£ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<code>ClassReader</code>è¯»å–æ‰€ä¼ å…¥çš„ byte æ•°ç»„ï¼Œå¹¶å°†å…¶è½¬æ¢æˆ<code>ClassNode</code>ã€‚ç„¶åæˆ‘ä»¬å°†éå†<code>ClassNode</code>ä¸­çš„<code>MethodNode</code>èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯¥ç±»ä¸­çš„æ„é€ å™¨å’Œæ–¹æ³•ã€‚</p> <p>å½“é‡åˆ°åå­—ä¸º<code>&quot;main&quot;</code>çš„æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ–¹æ³•çš„å…¥å£å¤„æ³¨å…¥<code>System.out.println(&quot;Hello, Instrumentation!&quot;);</code>ã€‚è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
$ java -javaagent:myagent.jar -cp .:/PATH/TO/asm-7.0-beta.jar:/PATH/TO/asm-tree-7.0-beta.jar HelloWorld

Hello, Instrumentation!

Hello, World!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Java agent è¿˜æä¾›äº†å¦å¤–ä¸¤ä¸ªåŠŸèƒ½<code>redefine</code>å’Œ<code>retransform</code>ã€‚è¿™ä¸¤ä¸ªåŠŸèƒ½é’ˆå¯¹çš„æ˜¯å·²åŠ è½½çš„ç±»ï¼Œå¹¶è¦æ±‚ç”¨æˆ·ä¼ å…¥æ‰€è¦<code>redefine</code>æˆ–è€…<code>retransform</code>çš„ç±»å®ä¾‹ã€‚</p> <p>å…¶ä¸­ï¼Œ<code>redefine</code>æŒ‡çš„æ˜¯èˆå¼ƒåŸæœ¬çš„å­—èŠ‚ç ï¼Œå¹¶æ›¿æ¢æˆç”±ç”¨æˆ·æä¾›çš„ byte æ•°ç»„ã€‚è¯¥åŠŸèƒ½æ¯”è¾ƒå±é™©ï¼Œä¸€èˆ¬ç”¨äºä¿®å¤å‡ºé”™äº†çš„å­—èŠ‚ç ã€‚</p> <p><code>retransform</code>åˆ™å°†é’ˆå¯¹æ‰€ä¼ å…¥çš„ç±»ï¼Œé‡æ–°è°ƒç”¨æ‰€æœ‰å·²æ³¨å†Œçš„<code>ClassFileTransformer</code>çš„<code>transform</code>æ–¹æ³•ã€‚å®ƒçš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰å¦‚ä¸‹ä¸¤ä¸ªã€‚</p> <p>ç¬¬ä¸€ï¼Œåœ¨æ‰§è¡Œ<code>premain</code>æˆ–è€…<code>agentmain</code>æ–¹æ³•å‰ï¼ŒJava è™šæ‹Ÿæœºæ—©å·²åŠ è½½äº†ä¸å°‘ç±»ï¼Œè€Œè¿™äº›ç±»çš„åŠ è½½äº‹ä»¶å¹¶æ²¡æœ‰è¢«æ‹¦æˆªï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰è¢«æ³¨å…¥ã€‚ä½¿ç”¨<code>retransform</code>åŠŸèƒ½å¯ä»¥æ³¨å…¥è¿™äº›å·²åŠ è½½ä½†æœªæ³¨å…¥çš„ç±»ã€‚</p> <p>ç¬¬äºŒï¼Œåœ¨å®šä¹‰äº†å¤šä¸ª Java agentï¼Œå¤šä¸ªæ³¨å…¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ç§»é™¤å…¶ä¸­çš„éƒ¨åˆ†æ³¨å…¥ã€‚å½“è°ƒç”¨<code>Instrumentation.removeTransformer</code>å»é™¤æŸä¸ªæ³¨å…¥ç±»åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨<code>retransform</code>åŠŸèƒ½ï¼Œé‡æ–°ä»åŸå§‹ byte æ•°ç»„å¼€å§‹è¿›è¡Œæ³¨å…¥ã€‚</p> <p>Java agent çš„è¿™äº›åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ JVMTI agentï¼Œä¹Ÿå°±æ˜¯ C agent æ¥å®ç°çš„ã€‚JVMTI æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„å·¥å…·å®ç°æ¥å£ï¼Œé€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨ C agent åŠ è½½åçš„å…¥å£æ–¹æ³•<code>Agent_OnLoad</code>å¤„æ³¨å†Œå„ä¸ªäº‹ä»¶çš„é’©å­ï¼ˆhookï¼‰æ–¹æ³•ã€‚å½“ Java è™šæ‹Ÿæœºè§¦å‘äº†è¿™äº›äº‹ä»¶æ—¶ï¼Œä¾¿ä¼šè°ƒç”¨å¯¹åº”çš„é’©å­æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
JNIEXPORT jint JNICALL

Agent_OnLoad(JavaVM *vm, char *options, void *reserved);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º JVMTI ä¸­çš„<code>ClassFileLoadHook</code>äº‹ä»¶è®¾ç½®é’©å­ï¼Œä»è€Œåœ¨ C å±‚é¢æ‹¦æˆªæ‰€æœ‰çš„ç±»åŠ è½½äº‹ä»¶ã€‚å…³äº JVMTI çš„å…¶ä»–äº‹ä»¶ï¼Œä½ å¯ä»¥å‚è€ƒè¯¥<a href="https://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html#EventIndex" target="_blank" rel="noopener noreferrer">é“¾æ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h2 id="åŸºäºå­—èŠ‚ç æ³¨å…¥çš„-profiler"><a href="#åŸºäºå­—èŠ‚ç æ³¨å…¥çš„-profiler" class="header-anchor">#</a> åŸºäºå­—èŠ‚ç æ³¨å…¥çš„ profiler</h2> <p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å­—èŠ‚ç æ³¨å…¥æ¥å®ç°ä»£ç è¦†ç›–å·¥å…·ï¼ˆä¾‹å¦‚<a href="https://www.jacoco.org/jacoco/" target="_blank" rel="noopener noreferrer">JaCoCo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰ï¼Œæˆ–è€…å„å¼å„æ ·çš„ profilerã€‚</p> <p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šå®šä¹‰ä¸€ä¸ªè¿è¡Œæ—¶ç±»ï¼Œå¹¶åœ¨æŸä¸€ç¨‹åºè¡Œä¸ºçš„å‘¨å›´ï¼Œæ³¨å…¥å¯¹è¯¥è¿è¡Œæ—¶ç±»ä¸­æ–¹æ³•çš„è°ƒç”¨ï¼Œä»¥è¡¨ç¤ºè¯¥ç¨‹åºè¡Œä¸ºæ­£è¦å‘ç”Ÿæˆ–è€…å·²ç»å‘ç”Ÿã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
package org.example;

 

import java.util.concurrent.ConcurrentHashMap;

import java.util.concurrent.atomic.AtomicInteger;

 

public class MyProfiler {

  public static ConcurrentHashMap&lt;Class&lt;?&gt;, AtomicInteger&gt; data = new ConcurrentHashMap&lt;&gt;();

 

  public static void fireAllocationEvent(Class&lt;?&gt; klass) {

    data.computeIfAbsent(klass, kls -&gt; new AtomicInteger())

        .incrementAndGet();

  }

 

  public static void dump() {

    data.forEach((kls, counter) -&gt; {

      System.err.printf(&quot;%s: %d\n&quot;, kls.getName(), counter.get());

    });

  }

 

  static {

    Runtime.getRuntime().addShutdownHook(new Thread(MyProfiler::dump));

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢è¿™æ®µä»£ç ä¾¿æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç±»ã€‚è¯¥ç±»ç»´æŠ¤äº†ä¸€ä¸ª<code>HashMap</code>ï¼Œç”¨æ¥ç»Ÿè®¡æ¯ä¸ªç±»æ‰€æ–°å»ºå®ä¾‹çš„æ•°ç›®ã€‚å½“ç¨‹åºé€€å‡ºæ—¶ï¼Œæˆ‘ä»¬å°†é€ä¸ªæ‰“å°å‡ºæ¯ä¸ªç±»çš„åå­—ï¼Œä»¥åŠå…¶æ–°å»ºå®ä¾‹çš„æ•°ç›®ã€‚</p> <p>åœ¨ Java agent ä¸­ï¼Œæˆ‘ä»¬ä¼šæˆªè·æ­£åœ¨åŠ è½½çš„ç±»ï¼Œå¹¶ä¸”åœ¨æ¯æ¡<code>new</code>å­—èŠ‚ç ä¹‹åæ’å…¥å¯¹<code>fireAllocationEvent</code>æ–¹æ³•çš„è°ƒç”¨ï¼Œä»¥è¡¨ç¤ºå½“å‰æ­£åœ¨æ–°å»ºæŸä¸ªç±»çš„å®ä¾‹ã€‚å…·ä½“çš„æ³¨å…¥ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
package org.example;

 

import java.lang.instrument.*;

import java.security.ProtectionDomain;

 

import org.objectweb.asm.*;

import org.objectweb.asm.tree.*;

 

public class MyAgent {

 

  public static void premain(String args, Instrumentation instrumentation) {

    instrumentation.addTransformer(new MyTransformer());

  }

 

  static class MyTransformer implements ClassFileTransformer, Opcodes {

    public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,

        ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {

      if (className.startsWith(&quot;java&quot;)    ||

          className.startsWith(&quot;javax&quot;)   || 

          className.startsWith(&quot;jdk&quot;)     ||

          className.startsWith(&quot;sun&quot;)     ||

          className.startsWith(&quot;com/sun&quot;) ||

          className.startsWith(&quot;org/example&quot;)) {

        // Skip JDK classes and profiler classes

        return null;

      }

 

      ClassReader cr = new ClassReader(classfileBuffer);

      ClassNode classNode = new ClassNode(ASM7);

      cr.accept(classNode, ClassReader.SKIP_FRAMES);

 

      for (MethodNode methodNode : classNode.methods) {

        for (AbstractInsnNode node : methodNode.instructions.toArray()) {

          if (node.getOpcode() == NEW) {

            TypeInsnNode typeInsnNode = (TypeInsnNode) node;

 

            InsnList instrumentation = new InsnList();

            instrumentation.add(new LdcInsnNode(Type.getObjectType(typeInsnNode.desc)));

            instrumentation.add(new MethodInsnNode(INVOKESTATIC, &quot;org/example/MyProfiler&quot;, &quot;fireAllocationEvent&quot;,

                &quot;(Ljava/lang/Class;)V&quot;, false));

 

            methodNode.instructions.insert(node, instrumentation);

          }

        }

      }

 

      ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_FRAMES | ClassWriter.COMPUTE_MAXS);

      classNode.accept(cw);

      return cw.toByteArray();

    }

  }

 

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><p>ä½ æˆ–è®¸å·²ç»ç•™æ„åˆ°ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ’é™¤å¯¹ JDK ç±»ä»¥åŠè¯¥è¿è¡Œæ—¶ç±»çš„æ³¨å…¥ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹è¿™äº›ç±»çš„æ³¨å…¥å¾ˆå¯èƒ½é€ æˆæ­»å¾ªç¯è°ƒç”¨ï¼Œå¹¶æœ€ç»ˆæŠ›å‡º<code>StackOverflowException</code>å¼‚å¸¸ã€‚</p> <p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨<code>PrintStream.println</code>æ–¹æ³•å…¥å£å¤„æ³¨å…¥<code>System.out.println(&quot;blahblah&quot;)</code>ï¼Œç”±äº<code>out</code>æ˜¯<code>PrintStream</code>çš„å®ä¾‹ï¼Œå› æ­¤å½“æ‰§è¡Œæ³¨å…¥ä»£ç æ—¶ï¼Œæˆ‘ä»¬åˆä¼šè°ƒç”¨<code>PrintStream.println</code>æ–¹æ³•ï¼Œä»è€Œé€ æˆæ­»å¾ªç¯ã€‚</p> <p>è§£å†³è¿™ä¸€é—®é¢˜çš„å…³é”®åœ¨äºè®¾ç½®ä¸€ä¸ªçº¿ç¨‹ç§æœ‰çš„æ ‡è¯†ä½ï¼Œç”¨ä»¥åŒºåˆ†åº”ç”¨ä»£ç çš„ä¸Šä¸‹æ–‡ä»¥åŠæ³¨å…¥ä»£ç çš„ä¸Šä¸‹æ–‡ã€‚å½“å³å°†æ‰§è¡Œæ³¨å…¥ä»£ç æ—¶ï¼Œæˆ‘ä»¬å°†æ ¹æ®æ ‡è¯†ä½åˆ¤æ–­æ˜¯å¦å·²ç»ä½äºæ³¨å…¥ä»£ç çš„ä¸Šä¸‹æ–‡ä¹‹ä¸­ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™è®¾ç½®æ ‡è¯†ä½å¹¶æ­£å¸¸æ‰§è¡Œæ³¨å…¥ä»£ç ï¼›å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸å†æ‰§è¡Œæ³¨å…¥ä»£ç ã€‚</p> <p>å­—èŠ‚ç æ³¨å…¥çš„å¦ä¸€ä¸ªæŠ€æœ¯éš¾ç‚¹åˆ™æ˜¯å‘½åç©ºé—´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸å°‘åº”ç”¨ç¨‹åºéƒ½ä¾èµ–äºå­—èŠ‚ç å·¥ç¨‹åº“ ASMã€‚å½“æˆ‘ä»¬çš„æ³¨å…¥é€»è¾‘ä¾èµ–äº ASM æ—¶ï¼Œä¾¿æœ‰å¯èƒ½å‡ºç°æ³¨å…¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ ASMï¼Œè€Œåº”ç”¨ç¨‹åºä½¿ç”¨è¾ƒä½ç‰ˆæœ¬çš„ ASM çš„é—®é¢˜ã€‚</p> <p>JDK æœ¬èº«ä¹Ÿä½¿ç”¨äº† ASM åº“ï¼Œå¦‚ç”¨æ¥ç”Ÿæˆ Lambda è¡¨è¾¾å¼çš„é€‚é…å™¨ç±»ã€‚JDK çš„åšæ³•æ˜¯é‡å‘½åæ•´ä¸ª ASM åº“ï¼Œä¸ºæ‰€æœ‰ç±»çš„åŒ…åæ·»åŠ <code>jdk.internal</code>å‰ç¼€ã€‚æˆ‘ä»¬æ˜¾ç„¶ä¸å¥½ç›´æ¥æ›´æ”¹ ASM çš„åŒ…åï¼Œå› æ­¤éœ€è¦å€ŸåŠ©è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥éš”ç¦»å‘½åç©ºé—´ã€‚</p> <p>é™¤äº†ä¸Šè¿°æŠ€æœ¯éš¾ç‚¹ä¹‹å¤–ï¼ŒåŸºäºå­—èŠ‚ç æ³¨å…¥çš„å·¥å…·è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œé‚£ä¾¿æ˜¯è§‚å¯Ÿè€…æ•ˆåº”ï¼ˆobserver effectï¼‰å¯¹æ‰€æ”¶é›†çš„æ•°æ®é€ æˆçš„å½±å“ã€‚</p> <p>ä¸¾ä¸ªåˆ©ç”¨å­—èŠ‚ç æ³¨å…¥æ”¶é›†æ¯ä¸ªæ–¹æ³•çš„è¿è¡Œæ—¶é—´çš„ä¾‹å­ã€‚å‡è®¾æŸä¸ªæ–¹æ³•è°ƒç”¨äº†å¦ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½è¢«æ³¨å…¥äº†ï¼Œé‚£ä¹ˆç»Ÿè®¡è¢«è°ƒç”¨è€…è¿è¡Œæ—¶é—´çš„æ³¨å…¥ä»£ç æ‰€è€—è´¹çš„æ—¶é—´ï¼Œå°†ä¸å¯é¿å…åœ°è¢«è®¡å…¥è‡³è°ƒç”¨è€…æ–¹æ³•çš„è¿è¡Œæ—¶é—´ä¹‹ä¸­ã€‚</p> <p>å†ä¸¾ä¸€ä¸ªç»Ÿè®¡æ–°å»ºå¯¹è±¡æ•°ç›®çš„ä¾‹å­ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘å™¨ä¸­çš„é€ƒé€¸åˆ†æå¯èƒ½ä¼šä¼˜åŒ–æ‰æ–°å»ºå¯¹è±¡æ“ä½œï¼Œä½†å®ƒä¸ä¼šæ¶ˆé™¤ç›¸åº”çš„ç»Ÿè®¡æ“ä½œï¼Œæ¯”å¦‚ä¸Šè¿°ä¾‹å­ä¸­å¯¹<code>fireAllocationEvent</code>æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç»Ÿè®¡æ²¡æœ‰å®é™…å‘ç”Ÿçš„æ–°å»ºå¯¹è±¡æ“ä½œã€‚</p> <p>å¦ä¸€ç§æƒ…å†µåˆ™æ˜¯ï¼Œæˆ‘ä»¬æ‰€æ³¨å…¥çš„å¯¹<code>fireAllocationEvent</code>æ–¹æ³•çš„è°ƒç”¨ï¼Œå°†å½±å“åˆ°æ–¹æ³•å†…è”çš„å†³ç­–ã€‚å¦‚æœè¯¥æ–°å»ºå¯¹è±¡çš„æ„é€ å™¨è°ƒç”¨æ°å¥½å› æ­¤æ²¡æœ‰è¢«å†…è”ï¼Œä»è€Œé€ æˆå¯¹è±¡é€ƒé€¸ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸæœ¬èƒ½å¤Ÿè¢«é€ƒé€¸åˆ†æä¼˜åŒ–æ‰çš„æ–°å»ºå¯¹è±¡æ“ä½œå°†æ— æ³•ä¼˜åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç»Ÿè®¡åˆ°åŸæœ¬ä¸ä¼šå‘ç”Ÿçš„æ–°å»ºå¯¹è±¡æ“ä½œã€‚</p> <p>æ€»è€Œè¨€ä¹‹ï¼Œå½“ä½¿ç”¨å­—èŠ‚ç æ³¨å…¥å¼€å‘ profiler æ—¶ï¼Œéœ€è¦è¾©è¯åœ°çœ‹å¾…æ‰€æ”¶é›†çš„æ•°æ®ã€‚å®ƒä»…èƒ½è¡¨ç¤ºåœ¨è¢«æ³¨å…¥çš„æƒ…å†µä¸‹ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ï¼Œè€Œéæ²¡æœ‰æ³¨å…¥æƒ…å†µä¸‹çš„ç¨‹åºæ‰§è¡ŒçŠ¶æ€ã€‚</p> <h2 id="é¢å‘æ–¹é¢ç¼–ç¨‹"><a href="#é¢å‘æ–¹é¢ç¼–ç¨‹" class="header-anchor">#</a> é¢å‘æ–¹é¢ç¼–ç¨‹</h2> <p>è¯´åˆ°å­—èŠ‚ç æ³¨å…¥ï¼Œå°±ä¸å¾—ä¸æé¢å‘æ–¹é¢ç¼–ç¨‹ï¼ˆAspect-Oriented  Programmingï¼ŒAOPï¼‰ã€‚é¢å‘æ–¹é¢ç¼–ç¨‹çš„æ ¸å¿ƒç†å¿µæ˜¯å®šä¹‰åˆ‡å…¥ç‚¹ï¼ˆpointcutï¼‰ä»¥åŠé€šçŸ¥ï¼ˆadviceï¼‰ã€‚ç¨‹åºæ§åˆ¶æµä¸­æ‰€æœ‰åŒ¹é…è¯¥åˆ‡å…¥ç‚¹çš„è¿æ¥ç‚¹ï¼ˆjoinpointï¼‰éƒ½å°†æ‰§è¡Œè¿™æ®µé€šçŸ¥ä»£ç ã€‚</p> <p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŒ‡ä»£æ‰€æœ‰æ–¹æ³•å…¥å£çš„åˆ‡å…¥ç‚¹ï¼Œå¹¶æŒ‡å®šåœ¨è¯¥åˆ‡å…¥ç‚¹æ‰§è¡Œçš„â€œæ‰“å°è¯¥æ–¹æ³•çš„åå­—â€è¿™ä¸€é€šçŸ¥ã€‚é‚£ä¹ˆæ¯ä¸ªå…·ä½“çš„æ–¹æ³•å…¥å£ä¾¿æ˜¯ä¸€ä¸ªè¿æ¥ç‚¹ã€‚</p> <p>é¢å‘æ–¹é¢ç¼–ç¨‹çš„å…¶ä¸­ä¸€ç§å®ç°æ–¹å¼ä¾¿æ˜¯å­—èŠ‚ç æ³¨å…¥ï¼Œæ¯”å¦‚<a href="https://www.eclipse.org/aspectj/" target="_blank" rel="noopener noreferrer">AspectJ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿç›¸å½“äºä½¿ç”¨äº†é¢å‘æ–¹é¢ç¼–ç¨‹ï¼Œåœ¨æ‰€æœ‰çš„<code>new</code>å­—èŠ‚ç ä¹‹åæ‰§è¡Œäº†ä¸‹é¢è¿™æ ·ä¸€æ®µé€šçŸ¥ä»£ç ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
`MyProfiler.fireAllocationEvent(&lt;Target&gt;.class)`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æˆ‘æ›¾ç»å‚ä¸å¼€å‘è¿‡ä¸€ä¸ªåº”ç”¨äº†é¢å‘æ–¹é¢ç¼–ç¨‹æ€æƒ³çš„å­—èŠ‚ç æ³¨å…¥æ¡†æ¶<a href="https://disl.ow2.org/" target="_blank" rel="noopener noreferrer">DiSL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚å®ƒæ”¯æŒç”¨æ³¨è§£æ¥å®šä¹‰åˆ‡å…¥ç‚¹ï¼Œç”¨æ™®é€š Java æ–¹æ³•æ¥å®šä¹‰é€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨æ–¹æ³•å…¥å£å¤„æ‰“å°æ‰€åœ¨çš„æ–¹æ³•åï¼Œå¯ä»¥ç®€å•è¡¨ç¤ºä¸ºå¦‚ä¸‹ä»£ç ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
@Before(marker = BodyMarker.class)

static void onMethodEntry(MethodStaticContext msc) {

  System.out.println(msc.thisMethodFullName());

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¦‚æœæœ‰åŒå­¦å¯¹è¿™ä¸ªå·¥å…·æ„Ÿå…´è¶£ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆéœ€æ±‚æˆ–è€…å»ºè®®ï¼Œæ¬¢è¿ä½ åœ¨ç•™è¨€ä¸­æå‡ºã€‚</p> <h2 id="æ€»ç»“ä¸å®è·µ"><a href="#æ€»ç»“ä¸å®è·µ" class="header-anchor">#</a> æ€»ç»“ä¸å®è·µ</h2> <p>ä»Šå¤©æˆ‘ä»‹ç»äº† Java agent ä»¥åŠå­—èŠ‚ç æ³¨å…¥ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Java agent çš„ç±»åŠ è½½æ‹¦æˆªåŠŸèƒ½ï¼Œä¿®æ”¹æŸä¸ªç±»æ‰€å¯¹åº”çš„ byte æ•°ç»„ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªä¿®æ”¹è¿‡åçš„ byte æ•°ç»„å®Œæˆæ¥ä¸‹æ¥çš„ç±»åŠ è½½ã€‚</p> <p>åŸºäºå­—èŠ‚ç æ³¨å…¥çš„ profilerï¼Œå¯ä»¥ç»Ÿè®¡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æŸäº›è¡Œä¸ºçš„å‡ºç°æ¬¡æ•°ã€‚å¦‚æœéœ€è¦æ”¶é›† Java æ ¸å¿ƒç±»åº“çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°å¿ƒé¿å…æ— é™é€’å½’è°ƒç”¨ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥è§£å†³å‘½åç©ºé—´çš„é—®é¢˜ã€‚</p> <p>ç”±äºå­—èŠ‚ç æ³¨å…¥ä¼šäº§ç”Ÿè§‚å¯Ÿè€…æ•ˆåº”ï¼Œå› æ­¤åŸºäºè¯¥æŠ€æœ¯çš„ profiler æ‰€æ”¶é›†åˆ°çš„æ•°æ®å¹¶ä¸èƒ½åæ˜ ç¨‹åºçš„çœŸå®è¿è¡ŒçŠ¶æ€ã€‚å®ƒæ‰€åæ˜ çš„æ˜¯ç¨‹åºåœ¨è¢«æ³¨å…¥çš„æƒ…å†µä¸‹çš„æ‰§è¡ŒçŠ¶æ€ã€‚</p> <hr> <p>ä»Šå¤©çš„å®è·µç¯èŠ‚ï¼Œè¯·ä½ æ€è€ƒå¦‚ä½•æ³¨å…¥æ–¹æ³•å‡ºå£ã€‚é™¤äº†æ­£å¸¸æ‰§è¡Œè·¯å¾„ä¹‹å¤–ï¼Œä½ è¿˜éœ€è€ƒè™‘å¼‚å¸¸æ‰§è¡Œè·¯å¾„ã€‚</p> <h2 id="ä¿¡-7"><a href="#ä¿¡-7" class="header-anchor">#</a> ä¿¡(7)</h2> <ul><li></li></ul> <p>godtrue</p> <p>2018-10-13</p> <p>3</p> <p>é˜…è¿‡ç•™ç—•</p> <p>1ï¼šJava agent æ˜¯å•¥ç©æ„ï¼Ÿ
è¿™ä¸ªæ¦‚å¿µè€å¸ˆæ²¡æœ‰è¯¦ç»†è®²è§£ï¼Œæˆ‘çš„ç†è§£æ˜¯Javaè¯­è¨€çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè¿™ä¸ªç‰¹æ€§èƒ½å¤Ÿå®ç°Javaå­—èŠ‚ç çš„æ³¨å…¥</p> <p>2ï¼šJavaå­—èŠ‚ç çš„æ³¨å…¥æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿ
åœ¨å¹³æ—¶ç¼–ç¨‹å‡ ä¹æ²¡æœ‰ä½¿ç”¨åˆ°è¿™æ–¹é¢çš„åŠŸèƒ½ï¼Œåº”è¯¥æ˜¯åœ¨ä¸€äº›æ¡†æ¶çš„è®¾è®¡çš„æ—¶å€™æ‰ä½¿ç”¨å§ï¼æ¯”å¦‚ï¼šä¸“æ ä¸­æåˆ°çš„é¢ç›¸åˆ‡é¢ç¼–ç¨‹ã€‚</p> <p>3ï¼šJava agent æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ c agent æ¥å®ç°çš„ï¼Œé‚£ c agent æœ¬è´¨ä¸Šæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ
C agentæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„å·¥å…·å®ç°æ¥å£ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨ C agent åŠ è½½åçš„å…¥å£æ–¹æ¡ˆ Agent_OnLoadå¤„æ³¨å†Œå„ä¸ªäº‹ä»¶çš„é’©å­æ–¹æ³•ã€‚å½“Javaè™šæ‹Ÿæœºè§¦å‘äº†è¿™äº›äº‹ä»¶æ—¶ï¼Œä¾¿ä¼šè°ƒç”¨å¯¹åº”çš„é’©å­æ–¹æ³•</p> <p>4ï¼šç•™ä¸ªè¯å¤´
å†™ä»£ç å®ç°æŸäº›åŠŸèƒ½ï¼Œæˆ‘çš„ç†è§£æœ‰ä¸‰ä¸ªæ—¶é—´æ®µ
ç¬¬ä¸€ä¸ªï¼šæºç é˜¶æ®µï¼Œæœ€å¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯ç¼–ç¨‹çš„ä¸»è¦æ´»åŠ¨æ—¶é—´
ç¬¬äºŒä¸ªï¼šå­—èŠ‚ç é˜¶æ®µï¼Œæœ‰äº›åŠŸèƒ½å¯èƒ½ä¼šåœ¨åŠ è½½å­—èŠ‚ç æ—¶ä¿®æ”¹æˆ–è€…æ·»åŠ æŸäº›å­—èŠ‚ç ï¼ŒæŸäº›æ¡†æ¶åšçš„äº‹æƒ…
ç¬¬ä¸‰ä¸ªï¼šè¿è¡Œé˜¶æ®µï¼ŒæŸäº›å·¥å…·ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¿®æ”¹ä»£ç ï¼Œå®ç°è¿è¡Œæ—¶åŠŸèƒ½åˆ†æ”¯çš„æ§åˆ¶</p> <ul><li></li></ul> <p>å°ç¾</p> <p>2018-11-19</p> <p>2</p> <p>ç”¨attachçš„æ–¹å¼æ³¨å…¥å­—èŠ‚ç çš„æ—¶å€™é‡åˆ°äº†99çº¿å‡é«˜çš„æ€§èƒ½é—®é¢˜ï¼Œçœ‹ä¸€äº›èµ„æ–™è¯´ class redefinition çš„æ—¶å€™ä¼šé˜»å¡çº¿ç¨‹ã€‚è¯·é—®èƒ½è¯¦ç»†è®²ä¸‹å—ï¼Ÿ</p> <p>ä½œè€…å›å¤: ä½ æ˜¯åœ¨åšredefineæ—¶å‡ºé—®é¢˜ï¼Œè¿˜æ˜¯æ²¡è§¦å‘æ—¶ä¾¿å·²å‡ºé—®é¢˜ï¼Ÿ</p> <p>class redefinitionéœ€è¦çˆ¬æ¯ä¸ªçº¿ç¨‹çš„Javaæ ˆï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰ç”¨åˆ°è¢«redefineçš„ç±»çš„æ–¹æ³•ï¼Œå› æ­¤ä¼šstop-the-worldã€‚å¦å¤–ï¼Œredefineåï¼ŒJITâ€™edä»£ç ä¼šè¢«æŠ›å¼ƒï¼Œé‡æ–°è§£é‡Šæ‰§è¡Œ</p> <ul><li></li></ul> <p>feng</p> <p>2018-10-07</p> <p>2</p> <p>ç¬¬ä¸€ä¸ªå®éªŒåšçš„ä¸ä¸¥è°¨ï¼Œç¬¬ä¸€ï¼Œæœ¨æœ‰å®šä¹‰HelloWordç±»ï¼Œç¬¬äºŒï¼Œæ²¡æœ‰æ‰§è¡Œç¼–è¯‘æ“ä½œï¼Œä¸çŸ¥é“æ˜¯æœ‰æ„ä¸ºä¹‹ï¼Œè¿˜æ˜¯ä¸å°å¿ƒæŠŠæ­¥éª¤æ¼æ‰äº†</p> <ul><li></li></ul> <p>Scott</p> <p>2018-10-06</p> <p>1</p> <p>å‡ºæ–¹æ³•æ—¶éœ€è¦æ³¨å…¥çš„å­—èŠ‚ç é™¤äº†è¿”å›ï¼Œè¿˜æœ‰å‡ ç§æƒ…å†µï¼Œå¦‚æœæ²¡æœ‰catchå—ï¼Œå°±æ‹¦æˆªthrowï¼Œå¦‚æœæœ‰ï¼Œä½†æ˜¯catchå—é‡Œé¢å¯èƒ½æœ‰å¾ˆå¤šå±‚ï¼Œåªæ˜¯éå†inståº”è¯¥æ˜¯ä¸å¯ä»¥çš„</p> <p>ä½œè€…å›å¤: å…¶å®ä¸ç”¨ç®¡æœ‰æ²¡æœ‰catchå—ï¼Œæœ‰æ²¡æœ‰throwï¼Œç›´æ¥ç»™æ‰€æœ‰ä»£ç ç½©ä¸€ä¸ªcatch anyçš„å¼‚å¸¸å¤„ç†å°±è¡Œäº†</p> <ul><li></li></ul> <p>å¥‡å¥‡</p> <p>2019-04-29</p> <p>ASM7 GETSTATICè¿™äº›å¸¸é‡æ˜¯å“ªé‡Œæ¥çš„ï¼Ÿ</p> <ul><li></li></ul> <p>feng</p> <p>2018-10-07</p> <p>è¿˜æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œæ¯æ¬¡å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼Œobjc[2614]: Class JavaLaunchHelper is implemented in both  /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/bin/java (0x102f6f4c0) and  /Library/Java/JavaVirtualMachines/jdk1.8.0_31.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x104f384e0). One of the two will be used. Which one is undefined.</p> <p>è¯·é—®æ€ä¹ˆå¯ä»¥æ¶ˆé™¤ï¼Œè°¢è°¢</p> <ul><li></li></ul> <p>Scott</p> <p>2018-10-06</p> <p>æˆ‘çœ‹åˆ°äº†jvmtiå¯ä»¥å›è°ƒå¼‚å¸¸äº‹ä»¶ï¼Œä½†æ˜¯java.lang.instrumentåŒ…ä¸‹æ²¡æœ‰å¤„ç†è¿™ä¸ªäº‹ä»¶çš„ï¼Œåªèƒ½åœ¨loadæ—¶å›è°ƒï¼Œå¤„ç†å¼‚å¸¸ç©¶ç«Ÿæ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</p> <p>ä½œè€…å›å¤: InstrumentationåŒ…å¹¶æ²¡æœ‰æ‰€æœ‰JVMTIåŠŸèƒ½</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">12/1/2022, 11:41:05 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/ily55421" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:ily55421@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/ily55421" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>ily55421 </span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e5f1d04a.js" defer></script><script src="/assets/js/5.5ca26c73.js" defer></script><script src="/assets/js/59.e57a2ed8.js" defer></script>
  </body>
</html>
