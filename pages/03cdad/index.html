<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰ | ily55421</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132133.ico">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="ğŸ’»å­¦ä¹ ğŸ“è®°å½•ğŸ”—åˆ†äº«
å­¦æ— æ­¢å¢ƒæ˜¯æ°¸è¿œå‰è¿›çš„åŸºç¡€ï¼Œè·ƒç„¶çº¸ä¸Šæ˜¯å¯¹çŸ¥è¯†çš„æ€»ç»“äº¤ä»£ï¼Œä¸ä¼—åˆ†äº«åˆ™æ˜¯å®ç°ä»·å€¼çš„æœ€å¥½æ–¹å¼ã€‚">
    <meta name="keywords" content="ily55421,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.3485cdbd.css" as="style"><link rel="preload" href="/assets/js/app.7d303452.js" as="script"><link rel="preload" href="/assets/js/5.5ca26c73.js" as="script"><link rel="preload" href="/assets/js/64.8acdf960.js" as="script"><link rel="prefetch" href="/assets/js/10.32a16328.js"><link rel="prefetch" href="/assets/js/11.51f4dee0.js"><link rel="prefetch" href="/assets/js/12.47439b7b.js"><link rel="prefetch" href="/assets/js/13.fa6da581.js"><link rel="prefetch" href="/assets/js/14.a4af8b3e.js"><link rel="prefetch" href="/assets/js/15.1bac7980.js"><link rel="prefetch" href="/assets/js/16.c546c54e.js"><link rel="prefetch" href="/assets/js/17.f20cd564.js"><link rel="prefetch" href="/assets/js/18.24c1e8fa.js"><link rel="prefetch" href="/assets/js/19.f7f3859c.js"><link rel="prefetch" href="/assets/js/20.fdd42e3d.js"><link rel="prefetch" href="/assets/js/21.6ba6a340.js"><link rel="prefetch" href="/assets/js/22.9cecd4c0.js"><link rel="prefetch" href="/assets/js/23.226ec0a8.js"><link rel="prefetch" href="/assets/js/24.61460762.js"><link rel="prefetch" href="/assets/js/25.959b24cf.js"><link rel="prefetch" href="/assets/js/26.13687b6c.js"><link rel="prefetch" href="/assets/js/27.9d170506.js"><link rel="prefetch" href="/assets/js/28.dc7ad8e9.js"><link rel="prefetch" href="/assets/js/29.c282dc5f.js"><link rel="prefetch" href="/assets/js/30.5ac0a703.js"><link rel="prefetch" href="/assets/js/31.9be53d81.js"><link rel="prefetch" href="/assets/js/32.af321aa9.js"><link rel="prefetch" href="/assets/js/33.22323cf2.js"><link rel="prefetch" href="/assets/js/34.27b04db7.js"><link rel="prefetch" href="/assets/js/35.9c17aaa6.js"><link rel="prefetch" href="/assets/js/36.c96448a2.js"><link rel="prefetch" href="/assets/js/37.52426c49.js"><link rel="prefetch" href="/assets/js/38.3b48a828.js"><link rel="prefetch" href="/assets/js/39.ca2ac16d.js"><link rel="prefetch" href="/assets/js/40.433e390b.js"><link rel="prefetch" href="/assets/js/41.eaffc214.js"><link rel="prefetch" href="/assets/js/42.74ae3b99.js"><link rel="prefetch" href="/assets/js/43.95fe06e5.js"><link rel="prefetch" href="/assets/js/44.2d1d3a17.js"><link rel="prefetch" href="/assets/js/45.7533ec50.js"><link rel="prefetch" href="/assets/js/46.996e3dc6.js"><link rel="prefetch" href="/assets/js/47.b0f0b432.js"><link rel="prefetch" href="/assets/js/48.c5798cab.js"><link rel="prefetch" href="/assets/js/49.810367c4.js"><link rel="prefetch" href="/assets/js/50.94df25a8.js"><link rel="prefetch" href="/assets/js/51.519e0fa3.js"><link rel="prefetch" href="/assets/js/52.4d3b6457.js"><link rel="prefetch" href="/assets/js/53.2435b9f6.js"><link rel="prefetch" href="/assets/js/54.e740a6d3.js"><link rel="prefetch" href="/assets/js/55.15ee1ee7.js"><link rel="prefetch" href="/assets/js/56.e0786062.js"><link rel="prefetch" href="/assets/js/57.d096558c.js"><link rel="prefetch" href="/assets/js/58.1ddbe198.js"><link rel="prefetch" href="/assets/js/59.cddfae60.js"><link rel="prefetch" href="/assets/js/6.3396a9ee.js"><link rel="prefetch" href="/assets/js/60.7153e854.js"><link rel="prefetch" href="/assets/js/61.6a9d1e6b.js"><link rel="prefetch" href="/assets/js/62.7163655c.js"><link rel="prefetch" href="/assets/js/63.233025d8.js"><link rel="prefetch" href="/assets/js/65.21ffb00b.js"><link rel="prefetch" href="/assets/js/66.b61bcbe7.js"><link rel="prefetch" href="/assets/js/67.5a4373f4.js"><link rel="prefetch" href="/assets/js/68.5fc2f918.js"><link rel="prefetch" href="/assets/js/69.89b9f203.js"><link rel="prefetch" href="/assets/js/7.0d4d4fc2.js"><link rel="prefetch" href="/assets/js/70.aabdd5f2.js"><link rel="prefetch" href="/assets/js/71.b6915fdf.js"><link rel="prefetch" href="/assets/js/72.da3c82f2.js"><link rel="prefetch" href="/assets/js/73.8fa05628.js"><link rel="prefetch" href="/assets/js/74.c3624110.js"><link rel="prefetch" href="/assets/js/75.d7c29eb8.js"><link rel="prefetch" href="/assets/js/76.7a9eb09f.js"><link rel="prefetch" href="/assets/js/77.b2117079.js"><link rel="prefetch" href="/assets/js/78.52262f79.js"><link rel="prefetch" href="/assets/js/79.8f1945d3.js"><link rel="prefetch" href="/assets/js/8.26c87b90.js"><link rel="prefetch" href="/assets/js/80.9923e78a.js"><link rel="prefetch" href="/assets/js/81.c958c9d5.js"><link rel="prefetch" href="/assets/js/82.89821ab1.js"><link rel="prefetch" href="/assets/js/83.98c3c37f.js"><link rel="prefetch" href="/assets/js/84.7687ff76.js"><link rel="prefetch" href="/assets/js/85.fe2ec9a4.js"><link rel="prefetch" href="/assets/js/86.9f18d8e8.js"><link rel="prefetch" href="/assets/js/87.aa04c866.js"><link rel="prefetch" href="/assets/js/88.95a9ae6a.js"><link rel="prefetch" href="/assets/js/89.b995f813.js"><link rel="prefetch" href="/assets/js/9.6c002df9.js"><link rel="prefetch" href="/assets/js/90.4d87b2a1.js"><link rel="prefetch" href="/assets/js/91.90e5c75d.js"><link rel="prefetch" href="/assets/js/92.0fab5248.js"><link rel="prefetch" href="/assets/js/93.493feb99.js"><link rel="prefetch" href="/assets/js/94.0cae0a06.js"><link rel="prefetch" href="/assets/js/95.2a217ab7.js"><link rel="prefetch" href="/assets/js/96.362f53ea.js"><link rel="prefetch" href="/assets/js/mermaid.f2857331.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.c013cef0.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.23884ed8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3485cdbd.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.staticaly.com/gh/eryajf/tu/main/img/image_20220720_132208.png" alt="ily55421" class="logo"> <span class="site-name can-hide">ily55421</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•ä¸æ•°æ®ç»“æ„" class="dropdown-title"><a href="/algorithm/" class="link-title">ç®—æ³•ä¸æ•°æ®ç»“æ„</a> <span class="title" style="display:none;">ç®—æ³•ä¸æ•°æ®ç»“æ„</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24768e/" class="nav-link">ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/pages/24770e/" class="nav-link">æ•°æ®ç»“æ„</a></li><li class="dropdown-item"><!----> <a href="/pages/040924/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a4770e/" class="nav-link">ä¸“é¢˜æ–‡ç« </a></li><li class="dropdown-item"><!----> <a href="/pages/678015/" class="nav-link">Javaç³»åˆ—</a></li><li class="dropdown-item"><!----> <a href="/pages/0590ad/" class="nav-link">Mysqlç³»åˆ—</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bc7034/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ace3fe/" class="nav-link">JAVA</a></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f2e80b/" class="nav-link">Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</a></li><li class="dropdown-subitem"><a href="/pages/bf46c5/" class="nav-link">é«˜æ•ˆç¼–è¯‘</a></li><li class="dropdown-subitem"><a href="/pages/1261df/" class="nav-link">ä»£ç ä¼˜åŒ–</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">ç•™è¨€æ¿</a></div><div class="nav-item"><a href="https://ily55421.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æˆ‘çš„åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•ä¸æ•°æ®ç»“æ„" class="dropdown-title"><a href="/algorithm/" class="link-title">ç®—æ³•ä¸æ•°æ®ç»“æ„</a> <span class="title" style="display:none;">ç®—æ³•ä¸æ•°æ®ç»“æ„</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24768e/" class="nav-link">ç®—æ³•</a></li><li class="dropdown-item"><!----> <a href="/pages/24770e/" class="nav-link">æ•°æ®ç»“æ„</a></li><li class="dropdown-item"><!----> <a href="/pages/040924/" class="nav-link">åˆ·é¢˜</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ä¸“é¢˜" class="dropdown-title"><a href="/topic/" class="link-title">ä¸“é¢˜</a> <span class="title" style="display:none;">ä¸“é¢˜</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a4770e/" class="nav-link">ä¸“é¢˜æ–‡ç« </a></li><li class="dropdown-item"><!----> <a href="/pages/678015/" class="nav-link">Javaç³»åˆ—</a></li><li class="dropdown-item"><!----> <a href="/pages/0590ad/" class="nav-link">Mysqlç³»åˆ—</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç”Ÿæ´»" class="dropdown-title"><a href="/life/" class="link-title">ç”Ÿæ´»</a> <span class="title" style="display:none;">ç”Ÿæ´»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/bc7034/" class="nav-link">æœ€ä½³å®è·µ</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹" class="dropdown-title"><a href="/code/" class="link-title">ç¼–ç¨‹</a> <span class="title" style="display:none;">ç¼–ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ace3fe/" class="nav-link">JAVA</a></li><li class="dropdown-item"><h4>JVM</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/f2e80b/" class="nav-link">Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</a></li><li class="dropdown-subitem"><a href="/pages/bf46c5/" class="nav-link">é«˜æ•ˆç¼–è¯‘</a></li><li class="dropdown-subitem"><a href="/pages/1261df/" class="nav-link">ä»£ç ä¼˜åŒ–</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/categories/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">ç•™è¨€æ¿</a></div><div class="nav-item"><a href="https://ily55421.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æˆ‘çš„åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com//" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JAVA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f2e80b/" class="sidebar-link">Javaä»£ç æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Ÿ</a></li><li><a href="/pages/6e6e40/" class="sidebar-link">Javaçš„åŸºæœ¬ç±»å‹</a></li><li><a href="/pages/7d8aa1/" class="sidebar-link">Javaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½Javaç±»çš„</a></li><li><a href="/pages/e90758/" class="sidebar-link">JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li><li><a href="/pages/f8e553/" class="sidebar-link">JVMæ˜¯å¦‚ä½•æ‰§è¡Œæ–¹æ³•è°ƒç”¨çš„ï¼Ÿï¼ˆä¸‹ï¼‰</a></li><li><a href="/pages/fe4d39/" class="sidebar-link">JVMæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ï¼Ÿ</a></li><li><a href="/pages/fc5957/" class="sidebar-link">JVMæ˜¯å¦‚ä½•å®ç°åå°„çš„ï¼Ÿ</a></li><li><a href="/pages/3119a5/" class="sidebar-link">JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</a></li><li><a href="/pages/03cdad/" aria-current="page" class="active sidebar-link">JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/03cdad/#invokedynamic-æŒ‡ä»¤" class="sidebar-link">invokedynamic æŒ‡ä»¤</a></li><li class="sidebar-sub-header level2"><a href="/pages/03cdad/#java-8-çš„-lambda-è¡¨è¾¾å¼" class="sidebar-link">Java 8 çš„ Lambda è¡¨è¾¾å¼</a></li><li class="sidebar-sub-header level2"><a href="/pages/03cdad/#lambda-ä»¥åŠæ–¹æ³•å¥æŸ„çš„æ€§èƒ½åˆ†æ" class="sidebar-link">Lambda ä»¥åŠæ–¹æ³•å¥æŸ„çš„æ€§èƒ½åˆ†æ</a></li><li class="sidebar-sub-header level2"><a href="/pages/03cdad/#æ€»ç»“ä¸å®è·µ" class="sidebar-link">æ€»ç»“ä¸å®è·µ</a></li><li class="sidebar-sub-header level2"><a href="/pages/03cdad/#ä¿¡-12" class="sidebar-link">ä¿¡(12)</a></li></ul></li><li><a href="/pages/9c8181/" class="sidebar-link">Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li><li><a href="/pages/9735ec/" class="sidebar-link">åƒåœ¾å›æ”¶ï¼ˆä¸Šï¼‰</a></li><li><a href="/pages/8055d4/" class="sidebar-link">åƒåœ¾å›æ”¶ï¼ˆä¸‹ï¼‰</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>é«˜æ•ˆç¼–è¯‘</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ä»£ç ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E7%BC%96%E7%A8%8B%E4%B8%96%E7%95%8C" title="åˆ†ç±»" data-v-06225672>ç¼–ç¨‹ä¸–ç•Œ</a></li><li data-v-06225672><a href="/categories/?category=JVM" title="åˆ†ç±»" data-v-06225672>JVM</a></li><li data-v-06225672><a href="/categories/?category=Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86" title="åˆ†ç±»" data-v-06225672>Javaè™šæ‹ŸæœºåŸºæœ¬åŸç†</a></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/ily55421" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>ily55421</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="_09-jvmæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„-ä¸‹"><a href="#_09-jvmæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„-ä¸‹" class="header-anchor">#</a> 09 | JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸‹ï¼‰</h1> <p>ä¸Šå›è®²åˆ°ï¼Œä¸ºäº†è®©æ‰€æœ‰çš„åŠ¨ç‰©éƒ½èƒ½å‚åŠ èµ›é©¬ï¼ŒJava 7 å¼•å…¥äº† invokedynamic æœºåˆ¶ï¼Œå…è®¸è°ƒç”¨ä»»æ„ç±»çš„â€œèµ›è·‘â€æ–¹æ³•ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è®²è§£ invokedynamicï¼Œè€Œæ˜¯æ·±å…¥åœ°æ¢è®¨äº†å®ƒæ‰€ä¾èµ–çš„æ–¹æ³•å¥æŸ„ã€‚</p> <p>ä»Šå¤©ï¼Œæˆ‘ä¾¿æ¥æ­£å¼åœ°ä»‹ç» invokedynamic æŒ‡ä»¤ï¼Œè®²è®²å®ƒæ˜¯å¦‚ä½•ç”Ÿæˆè°ƒç”¨ç‚¹ï¼Œå¹¶ä¸”å…è®¸åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šé“¾æ¥è‡³å“ªä¸€ä¸ªæ–¹æ³•ä¸­çš„ã€‚</p> <h2 id="invokedynamic-æŒ‡ä»¤"><a href="#invokedynamic-æŒ‡ä»¤" class="header-anchor">#</a> invokedynamic æŒ‡ä»¤</h2> <p>invokedynamic æ˜¯ Java 7  å¼•å…¥çš„ä¸€æ¡æ–°æŒ‡ä»¤ï¼Œç”¨ä»¥æ”¯æŒåŠ¨æ€è¯­è¨€çš„æ–¹æ³•è°ƒç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå°†è°ƒç”¨ç‚¹ï¼ˆCallSiteï¼‰æŠ½è±¡æˆä¸€ä¸ª Java ç±»ï¼Œå¹¶ä¸”å°†åŸæœ¬ç”± Java  è™šæ‹Ÿæœºæ§åˆ¶çš„æ–¹æ³•è°ƒç”¨ä»¥åŠæ–¹æ³•é“¾æ¥æš´éœ²ç»™äº†åº”ç”¨ç¨‹åºã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ¡ invokedynamic  æŒ‡ä»¤å°†æ†ç»‘ä¸€ä¸ªè°ƒç”¨ç‚¹ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨è¯¥è°ƒç”¨ç‚¹æ‰€é“¾æ¥çš„æ–¹æ³•å¥æŸ„ã€‚</p> <p>åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ invokedynamic æŒ‡ä»¤æ—¶ï¼ŒJava è™šæ‹Ÿæœºä¼šè°ƒç”¨è¯¥æŒ‡ä»¤æ‰€å¯¹åº”çš„å¯åŠ¨æ–¹æ³•ï¼ˆBootStrap  Methodï¼‰ï¼Œæ¥ç”Ÿæˆå‰é¢æåˆ°çš„è°ƒç”¨ç‚¹ï¼Œå¹¶ä¸”å°†ä¹‹ç»‘å®šè‡³è¯¥ invokedynamic æŒ‡ä»¤ä¸­ã€‚åœ¨ä¹‹åçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJava  è™šæ‹Ÿæœºåˆ™ä¼šç›´æ¥è°ƒç”¨ç»‘å®šçš„è°ƒç”¨ç‚¹æ‰€é“¾æ¥çš„æ–¹æ³•å¥æŸ„ã€‚</p> <p>åœ¨å­—èŠ‚ç ä¸­ï¼Œå¯åŠ¨æ–¹æ³•æ˜¯ç”¨æ–¹æ³•å¥æŸ„æ¥æŒ‡å®šçš„ã€‚è¿™ä¸ªæ–¹æ³•å¥æŸ„æŒ‡å‘ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºè°ƒç”¨ç‚¹çš„é™æ€æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¿…é¡»æ¥æ”¶ä¸‰ä¸ªå›ºå®šçš„å‚æ•°ï¼Œåˆ†åˆ«ä¸ºä¸€ä¸ª Lookup ç±»å®ä¾‹ï¼Œä¸€ä¸ªç”¨æ¥æŒ‡ä»£ç›®æ ‡æ–¹æ³•åå­—çš„å­—ç¬¦ä¸²ï¼Œä»¥åŠè¯¥è°ƒç”¨ç‚¹èƒ½å¤Ÿé“¾æ¥çš„æ–¹æ³•å¥æŸ„çš„ç±»å‹ã€‚</p> <p>é™¤äº†è¿™ä¸‰ä¸ªå¿…éœ€å‚æ•°ä¹‹å¤–ï¼Œå¯åŠ¨æ–¹æ³•è¿˜å¯ä»¥æ¥æ”¶è‹¥å¹²ä¸ªå…¶ä»–çš„å‚æ•°ï¼Œç”¨æ¥è¾…åŠ©ç”Ÿæˆè°ƒç”¨ç‚¹ï¼Œæˆ–è€…å®šä½æ‰€è¦é“¾æ¥çš„ç›®æ ‡æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
import java.lang.invoke.*;

 

class Horse {

  public void race() {

    System.out.println(&quot;Horse.race()&quot;); 

  }

}

 

class Deer {

  public void race() {

    System.out.println(&quot;Deer.race()&quot;);

  }

}

 

// javac Circuit.java

// java Circuit

public class Circuit {

 

  public static void startRace(Object obj) {

    // aload obj

    // invokedynamic race()

  }

 

  public static void main(String[] args) {

    startRace(new Horse());

    // startRace(new Deer());

  }

  

  public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {

    MethodHandle mh = l.findVirtual(Horse.class, name, MethodType.methodType(void.class));

    return new ConstantCallSite(mh.asType(callSiteType));

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>æˆ‘åœ¨æ–‡ç¨¿ä¸­è´´äº†ä¸€æ®µä»£ç ï¼Œå…¶ä¸­ä¾¿åŒ…å«ä¸€ä¸ªå¯åŠ¨æ–¹æ³•ã€‚å®ƒå°†æ¥æ”¶å‰é¢æåˆ°çš„ä¸‰ä¸ªå›ºå®šå‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªé“¾æ¥è‡³ Horse.race æ–¹æ³•çš„ ConstantCallSiteã€‚</p> <p>è¿™é‡Œçš„ ConstantCallSite æ˜¯ä¸€ç§ä¸å¯ä»¥æ›´æ”¹é“¾æ¥å¯¹è±¡çš„è°ƒç”¨ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJava æ ¸å¿ƒç±»åº“è¿˜æä¾›å¤šç§å¯ä»¥æ›´æ”¹é“¾æ¥å¯¹è±¡çš„è°ƒç”¨ç‚¹ï¼Œæ¯”å¦‚ MutableCallSite å’Œ VolatileCallSiteã€‚</p> <p>è¿™ä¸¤è€…çš„åŒºåˆ«å°±å¥½æ¯”æ­£å¸¸å­—æ®µå’Œ volatile å­—æ®µä¹‹é—´çš„åŒºåˆ«ã€‚æ­¤å¤–ï¼Œåº”ç”¨ç¨‹åºè¿˜å¯ä»¥è‡ªå®šä¹‰è°ƒç”¨ç‚¹ç±»ï¼Œæ¥æ»¡è¶³ç‰¹å®šçš„é‡é“¾æ¥éœ€æ±‚ã€‚</p> <p>ç”±äº Java æš‚ä¸æ”¯æŒç›´æ¥ç”Ÿæˆ invokedynamic æŒ‡ä»¤ [1]ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä¼šå€ŸåŠ©ä¹‹å‰ä»‹ç»è¿‡çš„å­—èŠ‚ç å·¥å…· ASM æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
import java.io.IOException;

import java.lang.invoke.*;

import java.nio.file.*;

 

import org.objectweb.asm.*;

 

// javac -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper.java

// java -cp /path/to/asm-all-6.0_BETA.jar:. ASMHelper

// java Circuit

public class ASMHelper implements Opcodes {

 

  private static class MyMethodVisitor extends MethodVisitor {

 

    private static final String BOOTSTRAP_CLASS_NAME = Circuit.class.getName().replace('.', '/');

    private static final String BOOTSTRAP_METHOD_NAME = &quot;bootstrap&quot;;

    private static final String BOOTSTRAP_METHOD_DESC = MethodType

        .methodType(CallSite.class, MethodHandles.Lookup.class, String.class, MethodType.class)

        .toMethodDescriptorString();

 

    private static final String TARGET_METHOD_NAME = &quot;race&quot;;

    private static final String TARGET_METHOD_DESC = &quot;(Ljava/lang/Object;)V&quot;;

 

    public final MethodVisitor mv;

 

    public MyMethodVisitor(int api, MethodVisitor mv) {

      super(api);

      this.mv = mv;

    }

 

    @Override

    public void visitCode() {

      mv.visitCode();

      mv.visitVarInsn(ALOAD, 0);

      Handle h = new Handle(H_INVOKESTATIC, BOOTSTRAP_CLASS_NAME, BOOTSTRAP_METHOD_NAME, BOOTSTRAP_METHOD_DESC, false);

      mv.visitInvokeDynamicInsn(TARGET_METHOD_NAME, TARGET_METHOD_DESC, h);

      mv.visitInsn(RETURN);

      mv.visitMaxs(1, 1);

      mv.visitEnd();

    }

  }

 

  public static void main(String[] args) throws IOException {

    ClassReader cr = new ClassReader(&quot;Circuit&quot;);

    ClassWriter cw = new ClassWriter(cr, ClassWriter.COMPUTE_FRAMES);

    ClassVisitor cv = new ClassVisitor(ASM6, cw) {

      @Override

      public MethodVisitor visitMethod(int access, String name, String descriptor, String signature,

          String[] exceptions) {

        MethodVisitor visitor = super.visitMethod(access, name, descriptor, signature, exceptions);

        if (&quot;startRace&quot;.equals(name)) {

          return new MyMethodVisitor(ASM6, visitor);

        }

        return visitor;

      }

    };

    cr.accept(cv, ClassReader.SKIP_FRAMES);

 

    Files.write(Paths.get(&quot;Circuit.class&quot;), cw.toByteArray());

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><p>ä½ æ— éœ€ç†è§£ä¸Šé¢è¿™æ®µä»£ç çš„å…·ä½“å«ä¹‰ï¼Œåªé¡»äº†è§£å®ƒä¼šæ›´æ”¹åŒä¸€ç›®å½•ä¸‹ Circuit ç±»çš„ startRace(Object) æ–¹æ³•ï¼Œä½¿ä¹‹åŒ…å« invokedynamic æŒ‡ä»¤ï¼Œæ‰§è¡Œæ‰€è°“çš„èµ›è·‘æ–¹æ³•ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
 public static void startRace(java.lang.Object);

         0: aload_0

         1: invokedynamic #80,  0 // race:(Ljava/lang/Object;)V

         6: return
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¦‚æœä½ è¶³å¤Ÿç»†å¿ƒçš„è¯ï¼Œä½ ä¼šå‘ç°è¯¥æŒ‡ä»¤æ‰€è°ƒç”¨çš„èµ›è·‘æ–¹æ³•çš„æè¿°ç¬¦ï¼Œå’Œ Horse.race æ–¹æ³•æˆ–è€… Deer.race æ–¹æ³•çš„æè¿°ç¬¦å¹¶ä¸ä¸€è‡´ã€‚è¿™æ˜¯å› ä¸º invokedynamic  æŒ‡ä»¤æœ€ç»ˆè°ƒç”¨çš„æ˜¯æ–¹æ³•å¥æŸ„ï¼Œè€Œæ–¹æ³•å¥æŸ„ä¼šå°†è°ƒç”¨è€…å½“æˆç¬¬ä¸€ä¸ªå‚æ•°ã€‚å› æ­¤ï¼Œåˆšåˆšæåˆ°çš„é‚£ä¸¤ä¸ªæ–¹æ³•æ°æ°ç¬¦åˆè¿™ä¸ªæè¿°ç¬¦æ‰€å¯¹åº”çš„æ–¹æ³•å¥æŸ„ç±»å‹ã€‚</p> <p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ invokedynamic è°ƒç”¨ Horse.race æ–¹æ³•äº†ã€‚ä¸ºäº†æ”¯æŒè°ƒç”¨ä»»æ„ç±»çš„ race æ–¹æ³•ï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªç®€å•çš„å•æ€å†…è”ç¼“å­˜ã€‚å¦‚æœè°ƒç”¨è€…çš„ç±»å‹å‘½ä¸­ç¼“å­˜ä¸­çš„ç±»å‹ï¼Œä¾¿ç›´æ¥è°ƒç”¨ç¼“å­˜ä¸­çš„æ–¹æ³•å¥æŸ„ï¼Œå¦åˆ™ä¾¿æ›´æ–°ç¼“å­˜ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// éœ€è¦æ›´æ”¹ ASMHelper.MyMethodVisitor ä¸­çš„ BOOTSTRAP_CLASS_NAME

import java.lang.invoke.*;

 

public class MonomorphicInlineCache {

 

  private final MethodHandles.Lookup lookup;

  private final String name;

 

  public MonomorphicInlineCache(MethodHandles.Lookup lookup, String name) {

    this.lookup = lookup;

    this.name = name;

  }

 

  private Class&lt;?&gt; cachedClass = null;

  private MethodHandle mh = null;

 

  public void invoke(Object receiver) throws Throwable {

    if (cachedClass != receiver.getClass()) {

      cachedClass = receiver.getClass();

      mh = lookup.findVirtual(cachedClass, name, MethodType.methodType(void.class));

    }

    mh.invoke(receiver);

  }

 

  public static CallSite bootstrap(MethodHandles.Lookup l, String name, MethodType callSiteType) throws Throwable {

    MonomorphicInlineCache ic = new MonomorphicInlineCache(l, name);

    MethodHandle mh = l.findVirtual(MonomorphicInlineCache.class, &quot;invoke&quot;, MethodType.methodType(void.class, Object.class));

    return new ConstantCallSite(mh.bindTo(ic));

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡ invokedynamic æŒ‡ä»¤è°ƒç”¨çš„æ˜¯æ‰€è°“çš„ race æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘è¿”å›äº†ä¸€ä¸ªé“¾æ¥è‡³åä¸ºâ€œinvokeâ€çš„æ–¹æ³•çš„è°ƒç”¨ç‚¹ã€‚ç”±äºè°ƒç”¨ç‚¹ä»…è¦æ±‚æ–¹æ³•å¥æŸ„çš„ç±»å‹èƒ½å¤ŸåŒ¹é…ï¼Œå› æ­¤è¿™ä¸ªé“¾æ¥æ˜¯åˆæ³•çš„ã€‚</p> <p>ä¸è¿‡ï¼Œè¿™æ­£æ˜¯ invokedynamic çš„ç›®çš„ï¼Œä¹Ÿå°±æ˜¯å°†è°ƒç”¨ç‚¹ä¸ç›®æ ‡æ–¹æ³•çš„é“¾æ¥äº¤ç”±åº”ç”¨ç¨‹åºæ¥åšï¼Œå¹¶ä¸”ä¾èµ–äºåº”ç”¨ç¨‹åºå¯¹ç›®æ ‡æ–¹æ³•è¿›è¡ŒéªŒè¯ã€‚æ‰€ä»¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå°†èµ›è·‘æ–¹æ³•é“¾æ¥è‡³å…”å­çš„ç¡è§‰æ–¹æ³•ï¼Œé‚£ä¹Ÿåªèƒ½æ€ªåº”ç”¨ç¨‹åºè‡ªå·±äº†ã€‚</p> <h2 id="java-8-çš„-lambda-è¡¨è¾¾å¼"><a href="#java-8-çš„-lambda-è¡¨è¾¾å¼" class="header-anchor">#</a> Java 8 çš„ Lambda è¡¨è¾¾å¼</h2> <p>åœ¨ Java 8 ä¸­ï¼ŒLambda è¡¨è¾¾å¼ä¹Ÿæ˜¯å€ŸåŠ© invokedynamic æ¥å®ç°çš„ã€‚</p> <p>å…·ä½“æ¥è¯´ï¼ŒJava ç¼–è¯‘å™¨åˆ©ç”¨ invokedynamic æŒ‡ä»¤æ¥ç”Ÿæˆå®ç°äº†å‡½æ•°å¼æ¥å£çš„é€‚é…å™¨ã€‚è¿™é‡Œçš„å‡½æ•°å¼æ¥å£æŒ‡çš„æ˜¯ä»…åŒ…æ‹¬ä¸€ä¸ªé  default æ¥å£æ–¹æ³•çš„æ¥å£ï¼Œä¸€èˆ¬é€šè¿‡ @FunctionalInterface æ³¨è§£ã€‚ä¸è¿‡å°±ç®—æ˜¯æ²¡æœ‰ä½¿ç”¨è¯¥æ³¨è§£ï¼ŒJava  ç¼–è¯‘å™¨ä¹Ÿä¼šå°†ç¬¦åˆæ¡ä»¶çš„æ¥å£è¾¨è®¤ä¸ºå‡½æ•°å¼æ¥å£ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
int x = ..

IntStream.of(1, 2, 3).map(i -&gt; i * 2).map(i -&gt; i * x);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢è¿™æ®µä»£ç ä¼šå¯¹ IntStream ä¸­çš„å…ƒç´ è¿›è¡Œä¸¤æ¬¡æ˜ å°„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ˜ å°„æ–¹æ³• map æ‰€æ¥æ”¶çš„å‚æ•°æ˜¯ IntUnaryOperatorï¼ˆè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å°† i-&gt;i<em>2 å’Œ i-&gt;i</em>x è¿™ä¸¤ä¸ª Lambda è¡¨è¾¾å¼è½¬åŒ–æˆ IntUnaryOperator çš„å®ä¾‹ã€‚è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹ä¾¿æ˜¯ç”± invokedynamic æ¥å®ç°çš„ã€‚</p> <p>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼ŒJava ç¼–è¯‘å™¨ä¼šå¯¹ Lambda è¡¨è¾¾å¼è¿›è¡Œè§£è¯­æ³•ç³–ï¼ˆdesugarï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–¹æ³•æ¥ä¿å­˜ Lambda  è¡¨è¾¾å¼çš„å†…å®¹ã€‚è¯¥æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸ä»…åŒ…å«åŸæœ¬ Lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼Œè¿˜åŒ…å«å®ƒæ‰€æ•è·çš„å˜é‡ã€‚(æ³¨ï¼šæ–¹æ³•å¼•ç”¨ï¼Œå¦‚  Horse::raceï¼Œåˆ™ä¸ä¼šç”Ÿæˆç”Ÿæˆé¢å¤–çš„æ–¹æ³•ã€‚)</p> <p>åœ¨ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ª Lambda è¡¨è¾¾å¼æ²¡æœ‰æ•è·å…¶ä»–å˜é‡ï¼Œè€Œç¬¬äºŒä¸ª Lambda è¡¨è¾¾å¼ï¼ˆä¹Ÿå°±æ˜¯ i-&gt;i*xï¼‰åˆ™ä¼šæ•è·å±€éƒ¨å˜é‡ xã€‚è¿™ä¸¤ä¸ª Lambda è¡¨è¾¾å¼å¯¹åº”çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æ•è·çš„å˜é‡åŒæ ·ä¹Ÿä¼šä½œä¸ºå‚æ•°ä¼ å…¥ç”Ÿæˆçš„æ–¹æ³•ä¹‹ä¸­ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
  // i -&gt; i * 2

  private static int lambda$0(int);

    Code:

       0: iload_0

       1: iconst_2

       2: imul

       3: ireturn

 

  // i -&gt; i * x

  private static int lambda$1(int, int);

    Code:

       0: iload_1

       1: iload_0

       2: imul

       3: ireturn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ invokedynamic æŒ‡ä»¤æ—¶ï¼Œå®ƒæ‰€å¯¹åº”çš„å¯åŠ¨æ–¹æ³•ä¼šé€šè¿‡ ASM  æ¥ç”Ÿæˆä¸€ä¸ªé€‚é…å™¨ç±»ã€‚è¿™ä¸ªé€‚é…å™¨ç±»å®ç°äº†å¯¹åº”çš„å‡½æ•°å¼æ¥å£ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¹Ÿå°±æ˜¯ IntUnaryOperatorã€‚å¯åŠ¨æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª  ConstantCallSiteï¼Œå…¶é“¾æ¥å¯¹è±¡ä¸ºä¸€ä¸ªè¿”å›é€‚é…å™¨ç±»å®ä¾‹çš„æ–¹æ³•å¥æŸ„ã€‚</p> <p>æ ¹æ® Lambda è¡¨è¾¾å¼æ˜¯å¦æ•è·å…¶ä»–å˜é‡ï¼Œå¯åŠ¨æ–¹æ³•ç”Ÿæˆçš„é€‚é…å™¨ç±»ä»¥åŠæ‰€é“¾æ¥çš„æ–¹æ³•å¥æŸ„çš†ä¸åŒã€‚</p> <p>å¦‚æœè¯¥ Lambda è¡¨è¾¾å¼æ²¡æœ‰æ•è·å…¶ä»–å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸Šä¸‹æ–‡æ— å…³çš„ã€‚å› æ­¤ï¼Œå¯åŠ¨æ–¹æ³•å°†æ–°å»ºä¸€ä¸ªé€‚é…å™¨ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•å¥æŸ„ï¼Œå§‹ç»ˆè¿”å›è¯¥å®ä¾‹ã€‚</p> <p>å¦‚æœè¯¥ Lambda è¡¨è¾¾å¼æ•è·äº†å…¶ä»–å˜é‡ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰§è¡Œè¯¥ invokedynamic æŒ‡ä»¤ï¼Œæˆ‘ä»¬éƒ½è¦æ›´æ–°è¿™äº›æ•è·äº†çš„å˜é‡ï¼Œä»¥é˜²æ­¢å®ƒä»¬å‘ç”Ÿäº†å˜åŒ–ã€‚</p> <p>å¦å¤–ï¼Œä¸ºäº†ä¿è¯ Lambda è¡¨è¾¾å¼çš„çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬æ— æ³•å…±äº«åŒä¸€ä¸ªé€‚é…å™¨ç±»çš„å®ä¾‹ã€‚å› æ­¤ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œ invokedynamic æŒ‡ä»¤æ—¶ï¼Œæ‰€è°ƒç”¨çš„æ–¹æ³•å¥æŸ„éƒ½éœ€è¦æ–°å»ºä¸€ä¸ªé€‚é…å™¨ç±»å®ä¾‹ã€‚</p> <p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯åŠ¨æ–¹æ³•ç”Ÿæˆçš„é€‚é…å™¨ç±»å°†åŒ…å«ä¸€ä¸ªé¢å¤–çš„é™æ€æ–¹æ³•ï¼Œæ¥æ„é€ é€‚é…å™¨ç±»çš„å®ä¾‹ã€‚è¯¥æ–¹æ³•å°†æ¥æ”¶è¿™äº›æ•è·çš„å‚æ•°ï¼Œå¹¶ä¸”å°†å®ƒä»¬ä¿å­˜ä¸ºé€‚é…å™¨ç±»å®ä¾‹çš„å®ä¾‹å­—æ®µã€‚</p> <p>ä½ å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•° -Djdk.internal.lambda.dumpProxyClasses=/DUMP/PATH å¯¼å‡ºè¿™äº›å…·ä½“çš„é€‚é…å™¨ç±»ã€‚è¿™é‡Œæˆ‘å¯¼å‡ºäº†ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ä¸¤ä¸ª Lambda è¡¨è¾¾å¼å¯¹åº”çš„é€‚é…å™¨ç±»ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// i-&gt;i*2 å¯¹åº”çš„é€‚é…å™¨ç±»

final class LambdaTest$$Lambda$1 implements IntUnaryOperator {

 private LambdaTest$$Lambda$1();

  Code:

    0: aload_0

    1: invokespecial java/lang/Object.&quot;&lt;init&gt;&quot;:()V

    4: return

 

 public int applyAsInt(int);

  Code:

    0: iload_1

    1: invokestatic LambdaTest.lambda$0:(I)I

    4: ireturn

}

 

// i-&gt;i*x å¯¹åº”çš„é€‚é…å™¨ç±»

final class LambdaTest$$Lambda$2 implements IntUnaryOperator {

 private final int arg$1;

 

 private LambdaTest$$Lambda$2(int);

  Code:

    0: aload_0

    1: invokespecial java/lang/Object.&quot;&lt;init&gt;&quot;:()V

    4: aload_0

    5: iload_1

    6: putfield arg$1:I

    9: return

 

 private static java.util.function.IntUnaryOperator get$Lambda(int);

  Code:

    0: new LambdaTest$$Lambda$2

    3: dup

    4: iload_0

    5: invokespecial &quot;&lt;init&gt;&quot;:(I)V

    8: areturn

 

 public int applyAsInt(int);

  Code:

    0: aload_0

    1: getfield arg$1:I

    4: iload_1

    5: invokestatic LambdaTest.lambda$1:(II)I

    8: ireturn

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•è·äº†å±€éƒ¨å˜é‡çš„ Lambda è¡¨è¾¾å¼å¤šå‡ºäº†ä¸€ä¸ª get$Lambda çš„æ–¹æ³•ã€‚å¯åŠ¨æ–¹æ³•ä¾¿ä¼šæ‰€è¿”å›çš„è°ƒç”¨ç‚¹é“¾æ¥è‡³æŒ‡å‘è¯¥æ–¹æ³•çš„æ–¹æ³•å¥æŸ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡æ‰§è¡Œ invokedynamic æŒ‡ä»¤æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è‡³è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¹¶æ„é€ ä¸€ä¸ªæ–°çš„é€‚é…å™¨ç±»å®ä¾‹ã€‚</p> <p>è¿™ä¸ªå¤šå‡ºæ¥çš„æ–°å»ºå®ä¾‹ä¼šå¯¹ç¨‹åºæ€§èƒ½é€ æˆå½±å“å—ï¼Ÿ</p> <h2 id="lambda-ä»¥åŠæ–¹æ³•å¥æŸ„çš„æ€§èƒ½åˆ†æ"><a href="#lambda-ä»¥åŠæ–¹æ³•å¥æŸ„çš„æ€§èƒ½åˆ†æ" class="header-anchor">#</a> Lambda ä»¥åŠæ–¹æ³•å¥æŸ„çš„æ€§èƒ½åˆ†æ</h2> <p>æˆ‘å†æ¬¡è¯·å‡ºæµ‹è¯•åå°„è°ƒç”¨æ€§èƒ½å¼€é”€çš„é‚£æ®µä»£ç ï¼Œå¹¶å°†å…¶æ”¹é€ æˆä½¿ç”¨ Lambda è¡¨è¾¾å¼çš„ v6 ç‰ˆæœ¬ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// v6 ç‰ˆæœ¬

import java.util.function.IntConsumer;

 

public class Test {

  public static void target(int i) { }

 

  public static void main(String[] args) throws Exception {

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      ((IntConsumer) j -&gt; Test.target(j)).accept(128);

      // ((IntConsumer) Test::target.accept(128);

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>æµ‹é‡ç»“æœæ˜¾ç¤ºï¼Œå®ƒä¸ç›´æ¥è°ƒç”¨çš„æ€§èƒ½å¹¶æ— å¤ªå¤§çš„åŒºåˆ«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³æ—¶ç¼–è¯‘å™¨èƒ½å¤Ÿå°†è½¬æ¢ Lambda è¡¨è¾¾å¼æ‰€ä½¿ç”¨çš„ invokedynamicï¼Œä»¥åŠå¯¹ IntConsumer.accept æ–¹æ³•çš„è°ƒç”¨ç»Ÿç»Ÿå†…è”è¿›æ¥ï¼Œæœ€ç»ˆä¼˜åŒ–ä¸ºç©ºæ“ä½œã€‚</p> <p>è¿™ä¸ªå…¶å®ä¸éš¾ç†è§£ï¼šLambda è¡¨è¾¾å¼æ‰€ä½¿ç”¨çš„ invokedynamic å°†ç»‘å®šä¸€ä¸ª  ConstantCallSiteï¼Œå…¶é“¾æ¥çš„ç›®æ ‡æ–¹æ³•æ— æ³•æ”¹å˜ã€‚å› æ­¤ï¼Œå³æ—¶ç¼–è¯‘å™¨ä¼šå°†è¯¥ç›®æ ‡æ–¹æ³•ç›´æ¥å†…è”è¿›æ¥ã€‚å¯¹äºè¿™ç±»æ²¡æœ‰æ•è·å˜é‡çš„ Lambda  è¡¨è¾¾å¼è€Œè¨€ï¼Œç›®æ ‡æ–¹æ³•åªå®Œæˆäº†ä¸€ä¸ªåŠ¨ä½œï¼Œä¾¿æ˜¯åŠ è½½ç¼“å­˜çš„é€‚é…å™¨ç±»å¸¸é‡ã€‚</p> <p>å¦ä¸€æ–¹é¢ï¼Œå¯¹ IntConsumer.accept æ–¹æ³•çš„è°ƒç”¨å®åˆ™æ˜¯å¯¹é€‚é…å™¨ç±»çš„ accept æ–¹æ³•çš„è°ƒç”¨ã€‚</p> <p>å¦‚æœä½ æŸ¥çœ‹äº† accept æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç çš„è¯ï¼Œä½ ä¼šå‘ç°å®ƒä»…åŒ…å«ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œè°ƒç”¨è‡³ Java ç¼–è¯‘å™¨åœ¨è§£ Lambda è¯­æ³•ç³–æ—¶ç”Ÿæˆçš„æ–¹æ³•ã€‚</p> <p>è¯¥æ–¹æ³•çš„å†…å®¹ä¾¿æ˜¯ Lambda è¡¨è¾¾å¼çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³• Test.targetã€‚å°†è¿™å‡ ä¸ªæ–¹æ³•è°ƒç”¨å†…è”è¿›æ¥ä¹‹åï¼ŒåŸæœ¬å¯¹ accept æ–¹æ³•çš„è°ƒç”¨åˆ™ä¼šè¢«ä¼˜åŒ–ä¸ºç©ºæ“ä½œã€‚</p> <p>ä¸‹é¢æˆ‘å°†ä¹‹å‰çš„ä»£ç æ›´æ”¹ä¸ºå¸¦æ•è·å˜é‡çš„ v7 ç‰ˆæœ¬ã€‚ç†è®ºä¸Šï¼Œæ¯æ¬¡è°ƒç”¨ invokedynamic æŒ‡ä»¤ï¼ŒJava è™šæ‹Ÿæœºéƒ½ä¼šæ–°å»ºä¸€ä¸ªé€‚é…å™¨ç±»çš„å®ä¾‹ã€‚ç„¶è€Œï¼Œå®é™…è¿è¡Œç»“æœè¿˜æ˜¯ä¸ç›´æ¥è°ƒç”¨çš„æ€§èƒ½ä¸€è‡´ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// v7 ç‰ˆæœ¬

import java.util.function.IntConsumer;

 

public class Test {

  public static void target(int i) { }

 

  public static void main(String[] args) throws Exception {

    int x = 2;

 

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      ((IntConsumer) j -&gt; Test.target(x + j)).accept(128);

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>æ˜¾ç„¶ï¼Œå³æ—¶ç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†æåˆå°†è¯¥æ–°å»ºå®ä¾‹ç»™ä¼˜åŒ–æ‰äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•° -XX:-DoEscapeAnalysis æ¥å…³é—­é€ƒé€¸åˆ†æã€‚æœç„¶ï¼Œè¿™æ—¶å€™æµ‹å¾—çš„å€¼çº¦ä¸ºç›´æ¥è°ƒç”¨çš„ 2.5 å€ã€‚</p> <p>å°½ç®¡é€ƒé€¸åˆ†æèƒ½å¤Ÿå»é™¤è¿™äº›é¢å¤–çš„æ–°å»ºå®ä¾‹å¼€é”€ï¼Œä½†æ˜¯å®ƒä¹Ÿä¸æ˜¯æ—¶æ—¶å¥æ•ˆã€‚å®ƒéœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä»¶äº‹ï¼šinvokedynamic æŒ‡ä»¤æ‰€æ‰§è¡Œçš„æ–¹æ³•å¥æŸ„èƒ½å¤Ÿå†…è”ï¼Œå’Œæ¥ä¸‹æ¥çš„å¯¹ accept æ–¹æ³•çš„è°ƒç”¨ä¹Ÿèƒ½å†…è”ã€‚</p> <p>åªæœ‰è¿™æ ·ï¼Œé€ƒé€¸åˆ†ææ‰èƒ½åˆ¤å®šè¯¥é€‚é…å™¨å®ä¾‹ä¸é€ƒé€¸ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸åœåœ°ç”Ÿæˆé€‚é…å™¨ç±»å®ä¾‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”å½“å°½é‡ä½¿ç”¨éæ•è·çš„ Lambda è¡¨è¾¾å¼ã€‚</p> <h2 id="æ€»ç»“ä¸å®è·µ"><a href="#æ€»ç»“ä¸å®è·µ" class="header-anchor">#</a> æ€»ç»“ä¸å®è·µ</h2> <p>ä»Šå¤©æˆ‘ä»‹ç»äº† invokedynamic æŒ‡ä»¤ä»¥åŠ Lambda è¡¨è¾¾å¼çš„å®ç°ã€‚</p> <p>invokedymaic æŒ‡ä»¤æŠ½è±¡å‡ºè°ƒç”¨ç‚¹çš„æ¦‚å¿µï¼Œå¹¶ä¸”å°†è°ƒç”¨è¯¥è°ƒç”¨ç‚¹æ‰€é“¾æ¥çš„æ–¹æ³•å¥æŸ„ã€‚åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ invokedynamic  æŒ‡ä»¤æ—¶ï¼ŒJava è™šæ‹Ÿæœºå°†æ‰§è¡Œå®ƒæ‰€å¯¹åº”çš„å¯åŠ¨æ–¹æ³•ï¼Œç”Ÿæˆå¹¶ä¸”ç»‘å®šä¸€ä¸ªè°ƒç”¨ç‚¹ã€‚ä¹‹åå¦‚æœå†æ¬¡æ‰§è¡Œè¯¥æŒ‡ä»¤ï¼ŒJava  è™šæ‹Ÿæœºåˆ™ç›´æ¥è°ƒç”¨å·²ç»ç»‘å®šäº†çš„è°ƒç”¨ç‚¹æ‰€é“¾æ¥çš„æ–¹æ³•ã€‚</p> <p>Lambda è¡¨è¾¾å¼åˆ°å‡½æ•°å¼æ¥å£çš„è½¬æ¢æ˜¯é€šè¿‡ invokedynamic æŒ‡ä»¤æ¥å®ç°çš„ã€‚è¯¥ invokedynamic æŒ‡ä»¤å¯¹åº”çš„å¯åŠ¨æ–¹æ³•å°†é€šè¿‡ ASM ç”Ÿæˆä¸€ä¸ªé€‚é…å™¨ç±»ã€‚</p> <p>å¯¹äºæ²¡æœ‰æ•è·å…¶ä»–å˜é‡çš„ Lambda è¡¨è¾¾å¼ï¼Œè¯¥ invokedynamic æŒ‡ä»¤å§‹ç»ˆè¿”å›åŒä¸€ä¸ªé€‚é…å™¨ç±»çš„å®ä¾‹ã€‚å¯¹äºæ•è·äº†å…¶ä»–å˜é‡çš„ Lambda è¡¨è¾¾å¼ï¼Œæ¯æ¬¡æ‰§è¡Œ invokedynamic æŒ‡ä»¤å°†æ–°å»ºä¸€ä¸ªé€‚é…å™¨ç±»å®ä¾‹ã€‚</p> <p>ä¸ç®¡æ˜¯æ•è·å‹çš„è¿˜æ˜¯æœªæ•è·å‹çš„ Lambda è¡¨è¾¾å¼ï¼Œå®ƒä»¬çš„æ€§èƒ½ä¸Šé™çš†å¯ä»¥è¾¾åˆ°ç›´æ¥è°ƒç”¨çš„æ€§èƒ½ã€‚å…¶ä¸­ï¼Œæ•è·å‹ Lambda è¡¨è¾¾å¼å€ŸåŠ©äº†å³æ—¶ç¼–è¯‘å™¨ä¸­çš„é€ƒé€¸åˆ†æï¼Œæ¥é¿å…å®é™…çš„æ–°å»ºé€‚é…å™¨ç±»å®ä¾‹çš„æ“ä½œã€‚</p> <p>åœ¨ä¸Šä¸€ç¯‡çš„è¯¾åå®è·µä¸­ï¼Œä½ åº”è¯¥æµ‹è¿‡è¿™ä¸€æ®µä»£ç çš„æ€§èƒ½å¼€é”€äº†ã€‚æˆ‘è¿™è¾¹æµ‹å¾—çš„ç»“æœçº¦ä¸ºç›´æ¥è°ƒç”¨çš„ 3.5 å€ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// v8 ç‰ˆæœ¬

import java.lang.invoke.MethodHandle;

import java.lang.invoke.MethodHandles;

import java.lang.invoke.MethodType;

 

public class Test {

  public static void target(int i) { }

 

  public static void main(String[] args) throws Exception {

    MethodHandles.Lookup l = MethodHandles.lookup();

    MethodType t = MethodType.methodType(void.class, int.class);

    MethodHandle mh = l.findStatic(Test.class, &quot;target&quot;, t);

 

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      mh.invokeExact(128);

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>å®é™…ä¸Šï¼Œå®ƒä¸ä½¿ç”¨ Lambda è¡¨è¾¾å¼æˆ–è€…æ–¹æ³•å¼•ç”¨çš„å·®åˆ«åœ¨äºï¼Œå³æ—¶ç¼–è¯‘å™¨æ— æ³•å°†è¯¥æ–¹æ³•å¥æŸ„è¯†åˆ«ä¸ºå¸¸é‡ï¼Œä»è€Œæ— æ³•è¿›è¡Œå†…è”ã€‚é‚£ä¹ˆå¦‚æœå°†å®ƒå˜æˆå¸¸é‡è¡Œä¸è¡Œå‘¢ï¼Ÿ</p> <p>ä¸€ç§æ–¹æ³•ä¾¿æ˜¯å°†å…¶èµ‹å€¼ç»™ final çš„é™æ€å˜é‡ï¼Œå¦‚ä¸‹é¢çš„ v9 ç‰ˆæœ¬æ‰€ç¤ºï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// v9 ç‰ˆæœ¬

import java.lang.invoke.MethodHandle;

import java.lang.invoke.MethodHandles;

import java.lang.invoke.MethodType;

 

public class Test {

  public static void target(int i) { }

 

  static final MethodHandle mh;

  static {

    try {

      MethodHandles.Lookup l = MethodHandles.lookup();

      MethodType t = MethodType.methodType(void.class, int.class);

      mh = l.findStatic(Test.class, &quot;target&quot;, t);

    } catch (Throwable e) {

      throw new RuntimeException(e);

    }

  }

 

  public static void main(String[] args) throws Throwable {

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      mh.invokeExact(128);

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>è¿™ä¸ªç‰ˆæœ¬æµ‹å¾—çš„æ•°æ®å’Œç›´æ¥è°ƒç”¨çš„æ€§èƒ½æ•°æ®ä¸€è‡´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³æ—¶ç¼–è¯‘å™¨èƒ½å¤Ÿå°†è¯¥æ–¹æ³•å¥æŸ„å®Œå…¨å†…è”è¿›æ¥ï¼Œæˆä¸ºç©ºæ“ä½œã€‚</p> <p>ä»Šå¤©çš„å®è·µç¯èŠ‚ï¼Œæˆ‘ä»¬æ¥ç»§ç»­æ¢ç´¢æ–¹æ³•å¥æŸ„çš„æ€§èƒ½ã€‚è¿è¡Œä¸‹é¢çš„ v10 ç‰ˆæœ¬ä»¥åŠ v11 ç‰ˆæœ¬ï¼Œæ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½å¹¶æ€è€ƒä¸ºä»€ä¹ˆã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
// v10 ç‰ˆæœ¬

import java.lang.invoke.*;

 

public class Test {

  public static void target(int i) {

  }

 

  public static class MyCallSite {

 

    public final MethodHandle mh;

 

    public MyCallSite() {

      mh = findTarget();

    }

 

    private static MethodHandle findTarget() {

      try {

        MethodHandles.Lookup l = MethodHandles.lookup();

        MethodType t = MethodType.methodType(void.class, int.class);

        return l.findStatic(Test.class, &quot;target&quot;, t);

      } catch (Throwable e) {

        throw new RuntimeException(e);

      }

    }

  }

 

  private static final MyCallSite myCallSite = new MyCallSite();

 

  public static void main(String[] args) throws Throwable {

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      myCallSite.mh.invokeExact(128);

    }

  }

}

 

// v11 ç‰ˆæœ¬

import java.lang.invoke.*;

 

public class Test {

  public static void target(int i) {

  }

 

  public static class MyCallSite extends ConstantCallSite {

 

    public MyCallSite() {

      super(findTarget());

    }

 

    private static MethodHandle findTarget() {

      try {

        MethodHandles.Lookup l = MethodHandles.lookup();

        MethodType t = MethodType.methodType(void.class, int.class);

        return l.findStatic(Test.class, &quot;target&quot;, t);

      } catch (Throwable e) {

        throw new RuntimeException(e);

      }

    }

  }

 

  public static final MyCallSite myCallSite = new MyCallSite();

 

  public static void main(String[] args) throws Throwable {

    long current = System.currentTimeMillis();

    for (int i = 1; i &lt;= 2_000_000_000; i++) {

      if (i % 100_000_000 == 0) {

        long temp = System.currentTimeMillis();

        System.out.println(temp - current);

        current = temp;

      }

 

      myCallSite.getTarget().invokeExact(128);

    }

  }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br></div></div><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§ã€‚</p> <p>[1] http://openjdk.java.net/jeps/303</p> <h2 id="ä¿¡-12"><a href="#ä¿¡-12" class="header-anchor">#</a> ä¿¡(12)</h2> <ul><li></li></ul> <p>ext4</p> <p>2018-08-11</p> <p>6</p> <p>æˆ‘çŸ¥é“Javaå¯¹Lambdaæœ‰ä¸ªè§„å®šï¼šâ€œThe variable used in Lambda should be final or effectively  final&quot;ï¼Œä¹Ÿå°±æ˜¯è¯´Lambdaè¡¨è¾¾å¼æ•è·çš„å˜é‡å¿…é¡»æ˜¯finalæˆ–ç­‰åŒäºfinalçš„ã€‚è€Œæ–‡ä¸­æ‚¨åˆè®²åˆ°ï¼šâ€œå¯¹äºæ•è·äº†å˜é‡çš„Lambdaï¼Œæ¯æ¬¡invokedynamicéƒ½éœ€è¦æ–°å»ºé€‚é…å™¨ç±»å®ä¾‹ï¼Œä»¥é˜²æ­¢ä»–ä»¬å‘ç”Ÿå˜åŒ–â€ã€‚JVMä¹‹æ‰€ä»¥è¿™ä¹ˆåšï¼Œæ˜¯å› ä¸ºè¿™ç§finalçš„è¦æ±‚ä»…é™äºJava sourceå±‚é¢ï¼Œåœ¨bytecodeå±‚é¢æ˜¯æ˜¯æ— æ³•ä¿è¯çš„ã€‚æˆ‘ç†è§£çš„å¯¹å—ï¼Ÿ</p> <p>ä½œè€…å›å¤: è¯­è¨€é‡Œçš„finalï¼Œæ˜¯å¯¹äºå½“å‰æ–¹æ³•è°ƒç”¨è€Œè¨€çš„ã€‚è¿™æ˜¯å› ä¸ºå®ƒå®é™…ä¸Šå°±ä¼ äº†ä¸ªå€¼è¿›å»ã€‚æ¯”å¦‚è¯´ä½ å®šä¹‰äº†int aï¼Œç„¶åä¼ å…¥ i -&gt; i +aé‡Œï¼Œé‚£ä¹ˆä¹‹åä½ å¯¹açš„ä¿®æ”¹lambdaæ˜¯çœ‹ä¸åˆ°çš„ã€‚</p> <p>é€‚é…å™¨é’ˆå¯¹çš„æ˜¯å¤šæ¬¡ä¸åŒè°ƒç”¨ï¼Œæ¯”å¦‚è¯´æ¯æ¬¡è°ƒç”¨ä½ å®šä¹‰çš„final int aéƒ½ä¸ä¸€æ ·ã€‚</p> <ul><li></li></ul> <p>code-arti...</p> <p>2018-08-14</p> <p>5</p> <p>ä¸€ç›´æ²¡ç†è§£â€œé€ƒé€¸åˆ†æâ€å•¥æ„æ€ï¼Ÿ</p> <p>ä½œè€…å›å¤: é€ƒé€¸åˆ†ææ˜¯æŒ‡é€šè¿‡æ•°æ®æµåˆ†æï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡ä¼šä¸ä¼šè¢«ä¼ é€’åˆ°å½“å‰ç¼–è¯‘çš„æ–¹æ³•ä¹‹å¤–ã€‚æ¯”å¦‚è¯´ä½ è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå°†ä¸€ä¸ªæ–°å»ºçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è¢«å†…è”ï¼Œåˆ™è¯´æ˜è¯¥æ–°å»ºå¯¹è±¡ä¼šé€ƒé€¸ã€‚</p> <p>é€ƒé€¸åˆ†ææ˜¯ä¸€é¡¹æ¯”è¾ƒé‡è¦çš„ä¼˜åŒ–ï¼Œæˆ‘åé¢ä¼šè¯¦ç»†è®²ã€‚</p> <ul><li></li></ul> <p>ç´ ä¸¶</p> <p>2018-11-07</p> <p>4</p> <p>https://zhuanlan.zhihu.com/p/26389041
https://zhuanlan.zhihu.com/p/30936412
å¯ä»¥å’Œ Shijie å¤§å¤§çš„ä¸¤ç¯‡æ–‡ç« é…åˆç€çœ‹ã€‚</p> <p>ä½œè€…å›å¤: èµï¼</p> <ul><li></li></ul> <p>karl</p> <p>2018-08-14</p> <p>3</p> <p>çœ‹äº†ä¸¤é å‹‰å¼ºæœ‰ä¸ªæ¦‚å¿µäº†
è¿˜æ˜¯åŸºç¡€ä¸å¤Ÿ çœ‹ä¸æ‡‚å•Š</p> <p>ä½œè€…å›å¤: invokedynamicæ¶‰åŠåˆ°çš„ä¸œè¥¿å¾ˆå¤šï¼Œåº•å±‚å®ç°ä¹Ÿåœ¨ä¸æ–­æ”¹è¿›ã€‚çœ‹æ‡‚ä¸ªå¤§æ¦‚å°±å¥½å•¦</p> <ul><li></li></ul> <p>å¾®ç¬‘</p> <p>2019-02-17</p> <p>1</p> <p>å¦‚æœè¯¥ Lambda è¡¨è¾¾å¼æ•è·äº†å…¶ä»–å˜é‡ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰§è¡Œè¯¥ invokedynamic æŒ‡ä»¤ï¼Œæˆ‘ä»¬éƒ½è¦æ›´æ–°è¿™äº›æ•è·äº†çš„å˜åŒ–ã€‚
é—®é¢˜ï¼šæ•è·çš„å˜é‡å¿…é¡»æ˜¯finalï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå˜å‘¢ï¼Œä¸ºä»€ä¹ˆä¼šçº¿ç¨‹ä¸å®‰å…¨å‘¢ï¼Ÿ</p> <ul><li></li></ul> <p>å°é³„é±¼</p> <p>2018-11-15</p> <p>1</p> <p>è€å¸ˆï¼Œçœ‹æ¥ä¸Šä¸€ç¯‡å’Œè¿™ç¯‡ï¼Œåˆä¸¤ä¸ªé—®é¢˜ï¼š
\1. å°½ç®¡é€ƒé€¸åˆ†æèƒ½å¤Ÿå»é™¤è¿™äº›é¢å¤–çš„æ–°å»ºå®ä¾‹å¼€é”€ï¼Œä½†æ˜¯å®ƒä¹Ÿä¸æ˜¯æ—¶æ—¶å¥æ•ˆã€‚é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ä¸å¥æ•ˆå‘¢ï¼Ÿ
\2. ä»€ä¹ˆæƒ…å†µä¸‹ç¼–è¯‘å™¨ä¼šå°†å¥æŸ„è¯†åˆ«æˆå¸¸é‡ï¼Ÿé™¤äº†æœ¬æ–‡ä¸­å°†MethodHandlerå®šä¹‰ä¸ºå¸¸é‡å¤–ï¼Œåœ¨å…¶ä»–ä»€ä¹ˆæƒ…å†µä¸‹èƒ½è¯†åˆ«ä¸ºå¸¸é‡å‘¢</p> <ul><li></li></ul> <p>Scott</p> <p>2018-08-19</p> <p>1</p> <p>è€å¸ˆä½ å¥½ï¼Œæˆ‘æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œ1æ˜¯æˆ‘çœ‹äº†å‡ ä¸ªæœ‰invokedynmaicæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œéƒ½æ˜¯invokedynamic #31,  0è¿™ç§å½¢å¼ï¼Œä¼¼ä¹åé¢è¿™ä¸ª0æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œç½‘ä¸Šinvokedynamicçš„è§£è¯´ä¹Ÿå¤§å¤šè¿‡æ—¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯1.8.0_181ç‰ˆæœ¬ã€‚2.  v10ç‰ˆæœ¬å’Œv11ç‰ˆæœ¬æ€§èƒ½çš„å·®è·æˆ‘çŒœæƒ³æ˜¯v10ç‰ˆæœ¬ä¸èƒ½æ­£ç¡®çš„å†…è”æ–¹æ³•å§ï¼Ÿè™½ç„¶mhæ˜¯finalçš„ï¼Œä½†æ˜¯å­—èŠ‚ç å±‚é¢å·²ç»ä¸¢å¤±è¿™ä¸ªä¿¡æ¯äº†ã€‚</p> <p>ä½œè€…å›å¤: 1. è¿™ä¸ªæ•°å­—0ï¼ŒæŒ‡çš„æ˜¯ç¬¬å‡ ä¸ªbootstrap methodï¼Œä½ å¤šå®šä¹‰å‡ ä¸ªlambdaï¼Œåº”è¯¥å¯ä»¥è§åˆ°1 2 3ç­‰ç­‰ã€‚</p> <p>\2. å¯¹çš„ï¼Œæ˜¯ä¸èƒ½å†…è”ã€‚ä¸è¿‡ï¼Œå­—èŠ‚ç ä¸­å­—æ®µå¤„è¿˜æ˜¯ä¼šæœ‰finalæ ‡å¿—çš„ã€‚C2è®¤ä¸ºfinalå®ä¾‹å­—æ®µåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸å˜çš„ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºå¯èƒ½é€šè¿‡Unsafeæ¥æ›´æ”¹ã€‚Graalè®¤ä¸ºå¯ä»¥å½“æˆä¸å˜çš„ï¼Œæ¯•ç«ŸJavaè¯­è¨€è§„èŒƒæ²¡æœ‰è§„å®šä¸å¯ä»¥ã€‚</p> <p>V11çš„è¯ï¼Œå¯ä»¥çœ‹å‡ºConstantCallsiteåŠæ—¶å­ç±»è¢«ç‰¹æ®Šå¯¹å¾…äº†ã€‚</p> <ul><li></li></ul> <p>å¤•æ—è¯­</p> <p>2019-04-17</p> <p>v10å’Œv11çš„åŒºåˆ«ä»…ä»…æ˜¯v11çš„å†…éƒ¨ç±»ç»§æ‰¿äº†ConstantCallSiteï¼ŒConstantCallSiteæ˜¯ä¸å¯è¢«æ›´æ”¹é“¾æ¥çš„è°ƒç”¨ç‚¹ï¼Œæ˜¯ä¸æ˜¯è¯´æ˜v11çš„å†…éƒ¨ç±»è¢«å†…è”äº†ï¼Ÿä»è€Œå¯ä»¥è¾¾åˆ°å’Œç›´æ¥è°ƒç”¨è¿‘ä¼¼çš„æ‰§è¡Œæ•ˆç‡</p> <ul><li></li></ul> <p>å°æ©™æ©™</p> <p>2018-08-19</p> <p>å…¶å®æœ‰ä¸ªåœ°æ–¹ä¸€ç›´æ²¡æœ‰æƒ³é€ï¼Œä¸ºä»€ä¹ˆè¦å­¦ä¹ å­—èŠ‚ç ï¼Œå­¦ä¹ å­—èŠ‚ç å¯¹æˆ‘ä»¬æ—¥å¸¸å¼€å‘æœ‰ä»€ä¹ˆä½œç”¨å—ï¼Œè€å¸ˆèƒ½å¦ç»™æŒ‡ç‚¹è¿·æ´¥ä¸€ä¸‹ï¼Ÿ</p> <p>ä½œè€…å›å¤: ä¸»è¦æ˜¯äº†è§£åº•å±‚å®ç°ã€‚</p> <p>å¯¹æ™®é€šçš„æ—¥å¸¸å¼€å‘å¯èƒ½ä½œç”¨ä¸å¤§ã€‚å¯¹äºè¿›é˜¶çš„ï¼Œæ¯”å¦‚åˆ†æåº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆï¼Œäº†è§£å­—èŠ‚ç å°†æœ‰æ‰€å¸®åŠ©ã€‚</p> <ul><li></li></ul> <p>Void_seT</p> <p>2018-08-11</p> <p>å•æ€å†…è”ç¼“å­˜çš„å®ç°ä»£ç æ®µï¼Œbootstrapæ–¹æ³•çš„å®ç°æœ‰é—®é¢˜ï¼Œæ²¡æœ‰returnä¸€ä¸ªCallSiteç±»å‹è¿”å›å€¼ã€‚å¦å¤–ï¼Œè¿™ç¯‡æœ‰ç‚¹éš¾åº¦äº†ï¼Œçœ‹äº†ä¸‰éï¼Œå‹‰å¼ºç†è§£ã€‚</p> <p>ä½œè€…å›å¤: å¤šè°¢æŒ‡å‡ºï¼</p> <ul><li></li></ul> <p>å°æ±Ÿ</p> <p>2018-08-10</p> <p>è€å¸ˆé‚®ç®±å¯ä»¥æä¾›ä¸€ä¸‹å—ï¼Œå’¨è¯¢ä¸€ä¸ªé—®é¢˜ï¼Œç»è¿‡btraceå¢å¼ºåclassæ–‡ä»¶é”™è¯¯é—®é¢˜</p> <ul><li></li></ul> <p>è‡ªæ¥ä¹Ÿ</p> <p>2018-08-10</p> <p>ç¤ºä¾‹åº”è¯¥ç”¨jdk.internal.org.objectweb.asm.*åŒ…å§ï¼Ÿ</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">12/12/2022, 9:46:20 AM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3119a5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</div></a> <a href="/pages/9c8181/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/3119a5/" class="prev">JVMæ˜¯æ€ä¹ˆå®ç°invokedynamicçš„ï¼Ÿï¼ˆä¸Šï¼‰</a></span> <span class="next"><a href="/pages/9c8181/">Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/ily55421" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:ily55421@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/ily55421" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2022-2022
    <span>ily55421 </span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7d303452.js" defer></script><script src="/assets/js/5.5ca26c73.js" defer></script><script src="/assets/js/64.8acdf960.js" defer></script>
  </body>
</html>
